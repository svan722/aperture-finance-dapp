"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[450],{70937:function(e,t,n){n.d(t,{$v:function(){return nd},W4:function(){return R},cH:function(){return ew}});var a,r,i=n(25248),u=n(47677),s=n(94817),o=n(76979),p=n(79669),l=n(88518),d=n(83349),c=n(77352),y=n(53926),m=n(35838),f=n(30733),T=n(84636),g=n(36762),h=n(41930),w=n(71480),b=n(25130),A=n(10362),v=n(34519),I=n(71406),E=n(4034),k=n(94030),P=n(93586),S=n(6647),q=n(5180),M=n(61111),N=n(58181),B=n(89810),x=n(55703);u.a_.ETHEREUM,u.a_.SEPOLIA,u.a_.BSC,u.a_.BSC_TESTNET,u.a_.ARBITRUM_ONE,u.a_.ARBITRUM_SEPOLIA,u.a_.POLYGON_ZKEVM,u.a_.POLYGON_ZKEVM_TESTNET,u.a_.BASE,u.a_.BASE_SEPOLIA,u.a_.ZKSYNC,u.a_.ZKSYNC_TESTNET,u.a_.LINEA,u.a_.LINEA_TESTNET,(0,i.r2)({},{APISchema:()=>t3,PancakeMulticallProvider:()=>tD,Transformer:()=>eb,buildBaseRoute:()=>X,createCommonTokenPriceProvider:()=>e3,createGetV2CandidatePools:()=>tk,createGetV3CandidatePools:()=>tx,createGetV3CandidatePoolsWithFallbacks:()=>tx,createHybridPoolProvider:()=>t_,createOffChainQuoteProvider:()=>tL,createPoolProvider:()=>tW,createPoolQuoteGetter:()=>tz,createQuoteProvider:()=>t5,createStaticPoolProvider:()=>tU,createV2PoolsProviderByCommonTokenPrices:()=>tI,encodeMixedRouteToPath:()=>V,getAllV3PoolsFromSubgraph:()=>tv,getBestTrade:()=>eJ,getCandidatePools:()=>tO,getCheckAgainstBaseTokens:()=>eL,getCommonTokenPrices:()=>tt,getCommonTokenPricesByLlma:()=>e7,getCommonTokenPricesBySubgraph:()=>e4,getCommonTokenPricesByWalletApi:()=>te,getExecutionPrice:()=>D,getMidPrice:()=>Y,getOutputOfPools:()=>Q,getPairCombinations:()=>e$,getPoolAddress:()=>z,getPriceImpact:()=>K,getStableCandidatePools:()=>tR,getStablePoolsOnChain:()=>ta,getTokenUsdPricesBySubgraph:()=>e9,getV2CandidatePools:()=>tP,getV2PoolSubgraph:()=>tb,getV2PoolsOnChain:()=>tn,getV2PoolsWithTvlByCommonTokenPrices:()=>tE,getV3CandidatePools:()=>tC,getV3PoolSubgraph:()=>th,getV3PoolsWithTvlFromOnChain:()=>tM,getV3PoolsWithTvlFromOnChainFallback:()=>tN,getV3PoolsWithTvlFromOnChainStaticFallback:()=>tB,getV3PoolsWithoutTicksOnChain:()=>tr,involvesCurrency:()=>L,isStablePool:()=>W,isV2Pool:()=>_,isV3Pool:()=>U,log:()=>ei,logger:()=>eu,maximumAmountIn:()=>es,metric:()=>er,minimumAmountOut:()=>eo,partitionMixedRouteByProtocol:()=>ep,v2PoolSubgraphSelection:()=>ty,v2PoolTvlSelector:()=>ty,v3PoolSubgraphSelection:()=>tc,v3PoolTvlSelector:()=>tc,v3PoolsOnChainProviderFactory:()=>tq});var C=function(e,t){if(e&&t)try{let n=(function(e,t){let[n,a="0"]=e.split("."),r=n.startsWith("-");if(r&&(n=n.slice(1)),a=a.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${a}`))&&(n=`${BigInt(n)+1n}`),a="";else if(a.length>t){let[e,r,i]=[a.slice(0,t-1),a.slice(t-1,t),a.slice(t)],u=Math.round(Number(`${r}.${i}`));(a=u>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${u}`).length>t&&(a=a.slice(1),n=`${BigInt(n)+1n}`),a=a.slice(0,t)}else a=a.padEnd(t,"0");return BigInt(`${r?"-":""}${n}${a}`)})(e,t.decimals).toString();if("0"!==n)return h.ih.fromRawAmount(t,BigInt(n))}catch(t){console.debug(`Failed to parse input amount: "${e}"`,t)}},R=((a=R||{})[a.V2=0]="V2",a[a.V3=1]="V3",a[a.STABLE=2]="STABLE",a),O=((r=O||{})[r.V2=0]="V2",r[r.V3=1]="V3",r[r.STABLE=2]="STABLE",r[r.MIXED=3]="MIXED",r[r.MM=4]="MM",r);function _(e){return 0===e.type}function U(e){return 1===e.type}function W(e){return 2===e.type&&e.balances.length>=2}function L(e,t){let n=t.wrapped;if(_(e)){let{reserve0:t,reserve1:a}=e;return t.currency.equals(n)||a.currency.equals(n)}if(U(e)){let{token0:t,token1:a}=e;return t.equals(n)||a.equals(n)}if(W(e)){let{balances:t}=e;return t.some(e=>e.currency.equals(n))}return!1}function $(e,t){let n=t.wrapped;if(_(e)){let{reserve0:t,reserve1:a}=e;return t.currency.equals(n)?a.currency:t.currency}if(U(e)){let{token0:t,token1:a}=e;return t.equals(n)?a:t}if(W(e)){let{balances:t}=e;return t[0].currency.equals(n)?t[1].currency:t[0].currency}throw Error("Cannot get output currency by invalid pool")}var G=f(g.d_,({deployerAddress:e,tokenA:t,tokenB:n,fee:a})=>`${t.chainId}_${e}_${t.address}_${n.address}_${a}`),F=f(s.sO.getAddress,(e,t)=>`${e.chainId}_${e.address}_${t.address}`),z=f(function(e){if(W(e)||U(e))return e.address;if(_(e)){let{reserve0:t,reserve1:n}=e;return F(t.currency.wrapped,n.currency.wrapped)}return""},e=>{if(W(e)){let{balances:t}=e,n=t.map(e=>e.currency.wrapped.address);return`${e.type}_${t[0]?.currency.chainId}_${n.join("_")}`}let[t,n]=_(e)?[e.reserve0.currency.wrapped,e.reserve1.currency.wrapped]:[e.token0.wrapped,e.token1.wrapped],a=U(e)?e.fee:"V2_FEE";return`${e.type}_${t.chainId}_${t.address}_${n.address}_${a}`});function j(e,t,n){if(U(e)){let{token0:n,token1:a,fee:r,liquidity:i,sqrtRatioX96:u,tick:s}=e,o=new g.Kg(n.wrapped,a.wrapped,r,u,i,s);return o.priceOf(t.wrapped)}if(_(e)){let n=new s.sO(e.reserve0.wrapped,e.reserve1.wrapped);return n.priceOf(t.wrapped)}if(W(e)){let{amplifier:a,balances:r,fee:i}=e,u=C("1",t);if(!u)throw Error(`Cannot parse amount for ${t.symbol}`);let o=(0,w.Zc)({amplifier:a,balances:r,fee:i,outputCurrency:n,amount:u});return new s.tA({baseAmount:u,quoteAmount:o})}return new s.tA(t,n,1n,0n)}function V(e,t){let n=e.input.wrapped,{path:a,types:r}=e.pools.reduce(({inputToken:e,path:t,types:n},a,r)=>{let u=$(a,e).wrapped,s=U(a)?a.fee:i.BR;return 0===r?{inputToken:u,types:["address","uint24","address"],path:[e.address,s,u.address]}:{inputToken:u,types:[...n,"uint24","address"],path:[...t,s,u.address]}},{inputToken:n,path:[],types:[]});return t?(0,o._)(r.reverse(),a.reverse()):(0,o._)(r,a)}function D(e){if(!e)return;let{inputAmount:t,outputAmount:n}=e;if(t.quotient!==s.xE&&n.quotient!==s.xE)return new s.tA(t.currency,n.currency,t.quotient,n.quotient)}function H(e){return s.FX[e]??null}var Q=(e,t)=>{let{inputToken:n}=e.reduce(({inputToken:e},t)=>{if(!L(t,e))throw Error("PATH");let n=$(t,e);return{inputToken:n}},{inputToken:t});return n};function X(e,t,n){let a=[t.wrapped],r=a[0],i=null,u=(e,t)=>null===t?Z(e):3===t||t!==Z(e)?3:t;for(let t of e)r=$(t,r),a.push(r),i=u(t,i);if(null===i)throw Error("Invalid route type when constructing base route");return{path:a,pools:e,type:i,input:t,output:n}}function Z(e){switch(e.type){case 0:return 0;case 1:return 1;case 2:return 2;default:return 3}}function Y({path:e,pools:t}){let n=0,a=null;for(let r of t){let t=e[n].wrapped,i=e[n+1].wrapped,u=j(r,t,i);a=a?a.multiply(u):u,n+=1}if(!a)throw Error("Get mid price failed");return a}function K(e){let t=s.ih.fromRawAmount(e.outputAmount.currency.wrapped,0);for(let n of e.routes){let{inputAmount:e}=n,a=Y(n);t=t.add(a.quote(e.wrapped))}let n=t.subtract(e.outputAmount.wrapped).divide(t);return new s.gG(n.numerator,n.denominator)}function J(e){return i.R[e]?.[0]??null}function ee(...e){let t=e[0]?.chainId;for(let n of e)if(n.chainId!==t)return!1;return!0}var et="smart-router",en={metric:"metric",log:"log",error:"error"},ea=b(et),er=ea.extend(en.metric),ei=ea.extend(en.log),eu={metric:er,log:ei,error:b(et).extend(en.error),enable:e=>{let t=e;t=e.includes(",")?e.split(",").map(e=>`${et}:${e}`).join(","):`${et}:${e}`,b.enable(t)}};function es(e,t,n=e.inputAmount){if(e.tradeType===s.YL.EXACT_INPUT)return n;let a=new s.iA(s.ry).add(t).multiply(n.quotient).quotient;return s.ih.fromRawAmount(n.currency,a)}function eo(e,t,n=e.outputAmount){if(e.tradeType===s.YL.EXACT_OUTPUT)return n;let a=new s.iA(s.ry).add(t).invert().multiply(n.quotient).quotient;return s.ih.fromRawAmount(n.currency,a)}var ep=e=>{let t=[],n=0,a=0;for(;a<e.pools.length;)e.pools[n].type!==e.pools[a].type&&(t.push(e.pools.slice(n,a)),n=a),++a===e.pools.length&&t.push(e.pools.slice(n,a));return t},el=class{constructor(){}static encodeApproveMax(e){return(0,p.R)({abi:el.ABI,functionName:"approveMax",args:[e.address]})}static encodeApproveMaxMinusOne(e){return(0,p.R)({abi:el.ABI,functionName:"approveMaxMinusOne",args:[e.address]})}static encodeApproveZeroThenMax(e){return(0,p.R)({abi:el.ABI,functionName:"approveZeroThenMax",args:[e.address]})}static encodeApproveZeroThenMaxMinusOne(e){return(0,p.R)({abi:el.ABI,functionName:"approveZeroThenMaxMinusOne",args:[e.address]})}static encodeCallPositionManager(e){if((0,A.Z)(e.length>0,"NULL_CALLDATA"),1===e.length)return(0,p.R)({abi:el.ABI,functionName:"callPositionManager",args:e});let t=(0,p.R)({abi:g.cK.ABI,functionName:"multicall",args:[e]});return(0,p.R)({abi:el.ABI,functionName:"callPositionManager",args:[t]})}static encodeAddLiquidity(e,t,n,a){let{amount0:r,amount1:i}=e.mintAmountsWithSlippage(a);return(t.amount0.quotient<r&&(r=t.amount0.quotient),t.amount1.quotient<i&&(i=t.amount1.quotient),Object.keys(n).some(e=>"recipient"===e))?(0,p.R)({abi:el.ABI,functionName:"mint",args:[{token0:e.pool.token0.address,token1:e.pool.token1.address,fee:e.pool.fee,tickLower:e.tickLower,tickUpper:e.tickUpper,amount0Min:r,amount1Min:i,recipient:n.recipient}]}):(0,p.R)({abi:el.ABI,functionName:"increaseLiquidity",args:[{token0:e.pool.token0.address,token1:e.pool.token1.address,amount0Min:r,amount1Min:i,tokenId:BigInt(n.tokenId)}]})}static encodeApprove(e,t){switch(t){case 1:return el.encodeApproveMax(e.wrapped);case 2:return el.encodeApproveMaxMinusOne(e.wrapped);case 3:return el.encodeApproveZeroThenMax(e.wrapped);case 4:return el.encodeApproveZeroThenMaxMinusOne(e.wrapped);default:throw Error("Error: invalid ApprovalType")}}},ed=el;ed.ABI=[{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveMax",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveMaxMinusOne",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveZeroThenMax",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveZeroThenMaxMinusOne",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"data",type:"bytes"}],name:"callPositionManager",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"getApprovalType",outputs:[{internalType:"enum IApproveAndCall.ApprovalType",name:"",type:"uint8"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"token0",type:"address"},{internalType:"address",name:"token1",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"uint256",name:"amount0Min",type:"uint256"},{internalType:"uint256",name:"amount1Min",type:"uint256"}],internalType:"struct IApproveAndCall.IncreaseLiquidityParams",name:"params",type:"tuple"}],name:"increaseLiquidity",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"token0",type:"address"},{internalType:"address",name:"token1",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"int24",name:"tickLower",type:"int24"},{internalType:"int24",name:"tickUpper",type:"int24"},{internalType:"uint256",name:"amount0Min",type:"uint256"},{internalType:"uint256",name:"amount1Min",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],internalType:"struct IApproveAndCall.MintParams",name:"params",type:"tuple"}],name:"mint",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"}];var ec=class{constructor(){}static encodeMulticall(e,t){if(void 0===t)return g.mG.encodeMulticall(e);if(Array.isArray(e)||(e=[e]),"string"==typeof t&&t.startsWith("0x")){let n=function(e){if(!e.match(/^0x[0-9a-fA-F]{64}$/))throw Error(`${e} is not valid bytes32.`);return e.toLowerCase()}(t);return(0,p.R)({abi:ec.ABI,functionName:"multicall",args:[n,e]})}let n=BigInt(t);return(0,p.R)({abi:ec.ABI,functionName:"multicall",args:[n,e]})}},ey=ec;function em(e){return e.multiply(1e4).quotient}ey.ABI=[{inputs:[{internalType:"bytes32",name:"previousBlockhash",type:"bytes32"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"}];var ef=class{constructor(){}static encodeUnwrapWETH9(e,t,n){if("string"==typeof t)return g.H4.encodeUnwrapWETH9(e,t,n);if(n){let t=em(n.fee),a=(0,s.qn)(n.recipient);return(0,p.R)({abi:ef.ABI,functionName:"unwrapWETH9WithFee",args:[e,t,a]})}return(0,p.R)({abi:ef.ABI,functionName:"unwrapWETH9",args:[e]})}static encodeSweepToken(e,t,n,a){if("string"==typeof n)return g.H4.encodeSweepToken(e,t,n,a);if(a){let n=em(a.fee),r=(0,s.qn)(a.recipient);return(0,p.R)({abi:ef.ABI,functionName:"sweepTokenWithFee",args:[e.address,t,n,r]})}return(0,p.R)({abi:ef.ABI,functionName:"sweepToken",args:[e.address,t]})}static encodePull(e,t){return(0,p.R)({abi:ef.ABI,functionName:"pull",args:[e.address,t]})}static encodeWrapETH(e){return(0,p.R)({abi:ef.ABI,functionName:"wrapETH",args:[e]})}},eT=ef;eT.ABI=[{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"pull",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"refundETH",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"}],name:"sweepToken",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"sweepTokenWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"sweepTokenWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"}],name:"unwrapWETH9",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],name:"unwrapWETH9",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"unwrapWETH9WithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"unwrapWETH9WithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"value",type:"uint256"}],name:"wrapETH",outputs:[],stateMutability:"payable",type:"function"}];var eg=new s.gG(50n,100n),eh=class{constructor(){}static encodeV2Swap(e,t,n,a){let r=es(e,t.slippageTolerance).quotient,u=eo(e,t.slippageTolerance).quotient,o=e.routes[0],l=o.path.map(e=>e.wrapped.address),d=n?i.ST:void 0===t.recipient?i.Vi:(0,s.qn)(t.recipient);return e.tradeType===s.YL.EXACT_INPUT?(0,p.R)({abi:eh.ABI,functionName:"swapExactTokensForTokens",args:[r,a?0n:u,l,d]}):(0,p.R)({abi:eh.ABI,functionName:"swapTokensForExactTokens",args:[u,r,l,d]})}static encodeStableSwap(e,t,n,a){let r=es(e,t.slippageTolerance).quotient,u=eo(e,t.slippageTolerance).quotient;if(e.routes.length>1||e.routes[0].pools.some(e=>!W(e)))throw Error("Unsupported trade to encode");let o=e.routes[0],l=o.path.map(e=>e.wrapped.address),d=o.pools.map(e=>BigInt(e.balances.length)),c=n?i.ST:void 0===t.recipient?i.Vi:(0,s.qn)(t.recipient);return e.tradeType===s.YL.EXACT_INPUT?(0,p.R)({abi:eh.ABI,functionName:"exactInputStableSwap",args:[l,d,r,a?0n:u,c]}):(0,p.R)({abi:eh.ABI,functionName:"exactOutputStableSwap",args:[l,d,u,r,c]})}static encodeV3Swap(e,t,n,a){let r=[];for(let u of e.routes){let{inputAmount:o,outputAmount:l,pools:d,path:c}=u,y=es(e,t.slippageTolerance,o).quotient,m=eo(e,t.slippageTolerance,l).quotient,f=1===d.length,T=n?i.ST:void 0===t.recipient?i.Vi:(0,s.qn)(t.recipient);if(f){if(e.tradeType===s.YL.EXACT_INPUT){let e={tokenIn:c[0].wrapped.address,tokenOut:c[1].wrapped.address,fee:d[0].fee,recipient:T,amountIn:y,amountOutMinimum:a?0n:m,sqrtPriceLimitX96:0n};r.push((0,p.R)({abi:eh.ABI,functionName:"exactInputSingle",args:[e]}))}else{let e={tokenIn:c[0].wrapped.address,tokenOut:c[1].wrapped.address,fee:d[0].fee,recipient:T,amountOut:m,amountInMaximum:y,sqrtPriceLimitX96:0n};r.push((0,p.R)({abi:eh.ABI,functionName:"exactOutputSingle",args:[e]}))}}else{let t=V({...u,input:o.currency,output:l.currency},e.tradeType===s.YL.EXACT_OUTPUT);if(e.tradeType===s.YL.EXACT_INPUT){let e={path:t,recipient:T,amountIn:y,amountOutMinimum:a?0n:m};r.push((0,p.R)({abi:eh.ABI,functionName:"exactInput",args:[e]}))}else{let e={path:t,recipient:T,amountOut:m,amountInMaximum:y};r.push((0,p.R)({abi:eh.ABI,functionName:"exactOutput",args:[e]}))}}}return r}static encodeMixedRouteSwap(e,t,n,a){let r=[],u=e.tradeType===s.YL.EXACT_INPUT;for(let o of e.routes){let{inputAmount:l,outputAmount:d,pools:c}=o,y=es(e,t.slippageTolerance,l).quotient,m=eo(e,t.slippageTolerance,d).quotient,f=1===c.length,T=n?i.ST:void 0===t.recipient?i.Vi:(0,s.qn)(t.recipient),g=e=>e.pools.every(U),h=e=>e.pools.every(_),w=e=>e.pools.every(W);if(f){if(g(o))r=[...r,...eh.encodeV3Swap({...e,routes:[o],inputAmount:l,outputAmount:d},t,n,a)];else if(h(o))r=[...r,eh.encodeV2Swap({...e,routes:[o],inputAmount:l,outputAmount:d},t,n,a)];else if(w(o))r=[...r,eh.encodeStableSwap({...e,routes:[o],inputAmount:l,outputAmount:d},t,n,a)];else throw Error("Unsupported route to encode")}else{let e;let t=ep(o),n=l.currency.wrapped;for(let a=0;a<t.length;a++){let s=t[a];e=Q(s,n);let o=X([...s],n,e);n=e.wrapped;let l=a===t.length-1,d=l?T:i.ST,c=0===a?y:0n,f=l?m:0n;if(g(o)){let e=V(o,!u);if(u){let t={path:e,recipient:d,amountIn:c,amountOutMinimum:f};r.push((0,p.R)({abi:eh.ABI,functionName:"exactInput",args:[t]}))}else{let t={path:e,recipient:T,amountOut:f,amountInMaximum:c};r.push((0,p.R)({abi:eh.ABI,functionName:"exactOutput",args:[t]}))}}else if(h(o)){let e=o.path.map(e=>e.wrapped.address);if(u){let t=[c,f,e,d];r.push((0,p.R)({abi:eh.ABI,functionName:"swapExactTokensForTokens",args:t}))}else{let t=[f,c,e,d];r.push((0,p.R)({abi:eh.ABI,functionName:"swapTokensForExactTokens",args:t}))}}else if(w(o)){let e=o.path.map(e=>e.wrapped.address),t=o.pools.map(e=>BigInt(e.balances.length));if(u){let n=[e,t,c,f,d];r.push((0,p.R)({abi:eh.ABI,functionName:"exactInputStableSwap",args:n}))}else{let n=[e,t,f,c,d];r.push((0,p.R)({abi:eh.ABI,functionName:"exactOutputStableSwap",args:n}))}}else throw Error("Unsupported route")}}}return r}static encodeSwaps(e,t,n){let a=Array.isArray(e)?e:[e],r=a.reduce((e,t)=>e+t.routes.length,0),i=a[0];(0,A.Z)(a.every(e=>e.inputAmount.currency.equals(i.inputAmount.currency)),"TOKEN_IN_DIFF"),(0,A.Z)(a.every(e=>e.outputAmount.currency.equals(i.outputAmount.currency)),"TOKEN_OUT_DIFF"),(0,A.Z)(a.every(e=>e.tradeType===i.tradeType),"TRADE_TYPE_DIFF");let u=[],o=i.inputAmount.currency.isNative,p=i.outputAmount.currency.isNative,l=i.tradeType===s.YL.EXACT_INPUT&&r>2,d=p||!!t.fee||!!n||l;for(let e of(t.inputTokenPermit&&((0,A.Z)(i.inputAmount.currency.isToken,"NON_TOKEN_PERMIT"),u.push(g.Im.encodePermit(i.inputAmount.currency,t.inputTokenPermit))),a))if(1===e.routes.length&&0===e.routes[0].type)u.push(eh.encodeV2Swap(e,t,d,l));else if(e.routes.every(e=>1===e.type))for(let n of eh.encodeV3Swap(e,t,d,l))u.push(n);else for(let n of eh.encodeMixedRouteSwap(e,t,d,l))u.push(n);let c=s.ih.fromRawAmount(i.inputAmount.currency,0),y=s.ih.fromRawAmount(i.outputAmount.currency,0),m=a.reduce((e,n)=>e.add(eo(n,t.slippageTolerance)),y),f=a.reduce((e,t)=>e.add(t.outputAmount),y),T=a.reduce((e,n)=>e.add(es(n,t.slippageTolerance)),c);return{calldatas:u,sampleTrade:i,routerMustCustody:d,inputIsNative:o,outputIsNative:p,totalAmountIn:T,minimumAmountOut:m,quoteAmountOut:f}}static swapCallParameters(e,t){let{calldatas:n,sampleTrade:a,routerMustCustody:r,inputIsNative:i,outputIsNative:u,totalAmountIn:o,minimumAmountOut:p}=eh.encodeSwaps(e,t);return r&&(u?n.push(eT.encodeUnwrapWETH9(p.quotient,t.recipient,t.fee)):n.push(eT.encodeSweepToken(a.outputAmount.currency.wrapped,p.quotient,t.recipient,t.fee))),i&&(a.tradeType===s.YL.EXACT_OUTPUT||eh.riskOfPartialFill(e))&&n.push(g.H4.encodeRefundETH()),{calldata:ey.encodeMulticall(n,t.deadlineOrPreviousBlockhash),value:(0,g._s)(i?o.quotient:0n)}}static swapAndAddCallParameters(e,t,n,a,r,i){let u;let{calldatas:o,inputIsNative:p,outputIsNative:l,sampleTrade:d,totalAmountIn:c,quoteAmountOut:y,minimumAmountOut:m}=eh.encodeSwaps(e,t,!0);t.outputTokenPermit&&((0,A.Z)(y.currency.isToken,"NON_TOKEN_PERMIT_OUTPUT"),o.push(g.Im.encodePermit(y.currency,t.outputTokenPermit)));let{inputAmount:{currency:{chainId:f}}}=d,T=n.pool.token0.wrapped.address===c.currency.wrapped.address,{positionAmountIn:h,positionAmountOut:w}=eh.getPositionAmounts(n,T),b=p?s.FX[f]:h.currency.wrapped,v=l?s.FX[f]:w.currency.wrapped,I=w.subtract(y.wrapped);I.greaterThan(s.ih.fromRawAmount(w.currency,0))&&(l?o.push(eT.encodeWrapETH(I.quotient)):o.push(eT.encodePull(v,I.quotient))),p?o.push(eT.encodeWrapETH(h.quotient)):o.push(eT.encodePull(b,h.quotient)),0!==r&&o.push(ed.encodeApprove(b,r)),0!==i&&o.push(ed.encodeApprove(v,i));let E=g.Ly.fromAmounts({pool:n.pool,tickLower:n.tickLower,tickUpper:n.tickUpper,amount0:T?n.amount0.quotient.toString():m.quotient.toString(),amount1:T?m.quotient.toString():n.amount1.quotient.toString(),useFullPrecision:!1});return o.push(ed.encodeAddLiquidity(n,E,a,t.slippageTolerance)),p?o.push(eT.encodeUnwrapWETH9(0n)):o.push(eT.encodeSweepToken(b,0n)),l?o.push(eT.encodeUnwrapWETH9(0n)):o.push(eT.encodeSweepToken(v,0n)),u=p?c.wrapped.add(h.wrapped).quotient:l?I.quotient:0n,{calldata:ey.encodeMulticall(o,t.deadlineOrPreviousBlockhash),value:(0,g._s)(u.toString())}}static riskOfPartialFill(e){return Array.isArray(e)?e.some(e=>eh.v3TradeWithHighPriceImpact(e)):eh.v3TradeWithHighPriceImpact(e)}static v3TradeWithHighPriceImpact(e){return!(1===e.routes.length&&0===e.routes[0].type)&&K(e).greaterThan(eg)}static getPositionAmounts(e,t){let{amount0:n,amount1:a}=e.mintAmounts,r=s.ih.fromRawAmount(e.pool.token0,n),i=s.ih.fromRawAmount(e.pool.token1,a),[u,o]=t?[r,i]:[i,r];return{positionAmountIn:u,positionAmountOut:o}}},ew=eh;ew.ABI=[{inputs:[{internalType:"address",name:"_factoryV2",type:"address"},{internalType:"address",name:"_deployer",type:"address"},{internalType:"address",name:"_factoryV3",type:"address"},{internalType:"address",name:"_positionManager",type:"address"},{internalType:"address",name:"_stableFactory",type:"address"},{internalType:"address",name:"_stableInfo",type:"address"},{internalType:"address",name:"_WETH9",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"factory",type:"address"},{indexed:!0,internalType:"address",name:"info",type:"address"}],name:"SetStableSwap",type:"event"},{inputs:[],name:"WETH9",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveMax",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveMaxMinusOne",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveZeroThenMax",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveZeroThenMaxMinusOne",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"data",type:"bytes"}],name:"callPositionManager",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes[]",name:"paths",type:"bytes[]"},{internalType:"uint128[]",name:"amounts",type:"uint128[]"},{internalType:"uint24",name:"maximumTickDivergence",type:"uint24"},{internalType:"uint32",name:"secondsAgo",type:"uint32"}],name:"checkOracleSlippage",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint24",name:"maximumTickDivergence",type:"uint24"},{internalType:"uint32",name:"secondsAgo",type:"uint32"}],name:"checkOracleSlippage",outputs:[],stateMutability:"view",type:"function"},{inputs:[],name:"deployer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMinimum",type:"uint256"}],internalType:"struct IV3SwapRouter.ExactInputParams",name:"params",type:"tuple"}],name:"exactInput",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMinimum",type:"uint256"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IV3SwapRouter.ExactInputSingleParams",name:"params",type:"tuple"}],name:"exactInputSingle",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address[]",name:"path",type:"address[]"},{internalType:"uint256[]",name:"flag",type:"uint256[]"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"exactInputStableSwap",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMaximum",type:"uint256"}],internalType:"struct IV3SwapRouter.ExactOutputParams",name:"params",type:"tuple"}],name:"exactOutput",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMaximum",type:"uint256"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IV3SwapRouter.ExactOutputSingleParams",name:"params",type:"tuple"}],name:"exactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address[]",name:"path",type:"address[]"},{internalType:"uint256[]",name:"flag",type:"uint256[]"},{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMax",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"exactOutputStableSwap",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factoryV2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"getApprovalType",outputs:[{internalType:"enum IApproveAndCall.ApprovalType",name:"",type:"uint8"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"token0",type:"address"},{internalType:"address",name:"token1",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"uint256",name:"amount0Min",type:"uint256"},{internalType:"uint256",name:"amount1Min",type:"uint256"}],internalType:"struct IApproveAndCall.IncreaseLiquidityParams",name:"params",type:"tuple"}],name:"increaseLiquidity",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"token0",type:"address"},{internalType:"address",name:"token1",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"int24",name:"tickLower",type:"int24"},{internalType:"int24",name:"tickUpper",type:"int24"},{internalType:"uint256",name:"amount0Min",type:"uint256"},{internalType:"uint256",name:"amount1Min",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],internalType:"struct IApproveAndCall.MintParams",name:"params",type:"tuple"}],name:"mint",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"previousBlockhash",type:"bytes32"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"int256",name:"amount0Delta",type:"int256"},{internalType:"int256",name:"amount1Delta",type:"int256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"pancakeV3SwapCallback",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"positionManager",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"pull",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"refundETH",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermit",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"uint256",name:"expiry",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermitAllowed",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"uint256",name:"expiry",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermitAllowedIfNecessary",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermitIfNecessary",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_info",type:"address"}],name:"setStableSwap",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"stableSwapFactory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"stableSwapInfo",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"}],name:"swapExactTokensForTokens",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMax",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"}],name:"swapTokensForExactTokens",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"}],name:"sweepToken",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"sweepTokenWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"sweepTokenWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],name:"unwrapWETH9",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"unwrapWETH9WithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"unwrapWETH9WithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"value",type:"uint256"}],name:"wrapETH",outputs:[],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}];var eb={};function eA(e){return{address:e.isNative?g.je:e.wrapped.address,decimals:e.decimals,symbol:e.symbol}}function ev(e){return{currency:eA(e.currency),value:e.quotient.toString()}}function eI(e){return{index:e.index,liquidityNet:String(e.liquidityNet),liquidityGross:String(e.liquidityGross)}}function eE(e){if(_(e))return{...e,reserve0:ev(e.reserve0),reserve1:ev(e.reserve1)};if(U(e))return{...e,token0:eA(e.token0),token1:eA(e.token1),liquidity:e.liquidity.toString(),sqrtRatioX96:e.sqrtRatioX96.toString(),token0ProtocolFee:e.token0ProtocolFee.toFixed(0),token1ProtocolFee:e.token1ProtocolFee.toFixed(0),ticks:e.ticks?.map(eI),reserve0:e.reserve0&&ev(e.reserve0),reserve1:e.reserve1&&ev(e.reserve1)};if(W(e))return{...e,balances:e.balances.map(ev),amplifier:e.amplifier.toString(),fee:e.fee.toSignificant(6)};throw Error("Cannot serialize unsupoorted pool")}function ek(e){return{...e,pools:e.pools.map(eE),path:e.path.map(eA),inputAmount:ev(e.inputAmount),outputAmount:ev(e.outputAmount)}}function eP(e){return{...e,inputAmount:ev(e.inputAmount),outputAmount:ev(e.outputAmount),routes:e.routes.map(ek),gasEstimate:e.gasEstimate.toString(),gasEstimateInUSD:e.gasEstimateInUSD&&ev(e.gasEstimateInUSD)}}function eS(e){return new g.dR(e)}function eq(e,t){if(t.address===g.je)return s._r.onChain(e);let{address:n,decimals:a,symbol:r}=t;return new s.Z$(e,n,a,r)}function eM(e,t){return s.ih.fromRawAmount(eq(e,t.currency),t.value)}function eN(e,t){if(0===t.type)return{...t,reserve0:eM(e,t.reserve0),reserve1:eM(e,t.reserve1)};if(1===t.type)return{...t,token0:eq(e,t.token0),token1:eq(e,t.token1),liquidity:BigInt(t.liquidity),sqrtRatioX96:BigInt(t.sqrtRatioX96),token0ProtocolFee:new s.gG(t.token0ProtocolFee,100n),token1ProtocolFee:new s.gG(t.token1ProtocolFee,100n),ticks:t.ticks?.map(eS),reserve0:t.reserve0&&eM(e,t.reserve0),reserve1:t.reserve1&&eM(e,t.reserve1)};if(2===t.type)return{...t,balances:t.balances.map(t=>eM(e,t)),amplifier:BigInt(t.amplifier),fee:new s.gG(1e6*parseFloat(t.fee),1000000n*100n)};throw Error("Cannot parse unsupoorted pool")}function eB(e,t){return{...t,pools:t.pools.map(t=>eN(e,t)),path:t.path.map(t=>eq(e,t)),inputAmount:eM(e,t.inputAmount),outputAmount:eM(e,t.outputAmount)}}function ex(e,t){return{...t,inputAmount:eM(e,t.inputAmount),outputAmount:eM(e,t.outputAmount),routes:t.routes.map(t=>eB(e,t)),gasEstimate:t.gasEstimate?BigInt(t.gasEstimate):0n,gasEstimateInUSD:t.gasEstimateInUSD&&eM(e,t.gasEstimateInUSD)}}(0,i.r2)(eb,{parseCurrency:()=>eq,parseCurrencyAmount:()=>eM,parsePool:()=>eN,parseRoute:()=>eB,parseTick:()=>eS,parseTrade:()=>ex,serializeCurrency:()=>eA,serializeCurrencyAmount:()=>ev,serializePool:()=>eE,serializeRoute:()=>ek,serializeTick:()=>eI,serializeTrade:()=>eP});var eC=c.jr[u.a_.BSC],eR=f((e,t)=>{if(!e||!t)return;let n=(0,y.o4)(e);for(let e of n)if(e.address.toLowerCase()===t.toLowerCase())return e},(e,t)=>`${e}_${t}`),eO=f(e=>eC.filter(t=>t.chainId===e),e=>e);function e_(e){return Boolean(e&&i.lM[e.chainId]?.find(t=>t.equals(e)))}var eU=f(e=>{let t=e?.chainId,n=e?.wrapped.address,a=eO(e?.chainId),r=new Set,i=e=>e&&!e_(e)&&r.add(e),u=e=>e.forEach(i),s=e=>e.toLowerCase()===n?.toLowerCase();if(e&&t&&e_(e.wrapped))return[];for(let e of a){let{type:n}=e;if(n===c.ly.V2||n===c.ly.V3){let{token0Address:n,token1Address:a}=e;s(n)&&i(eR(t,a)),s(a)&&i(eR(t,n));continue}if(n===c.ly.StableSwap){let{tokenAddresses:n}=e,a=n.findIndex(s);if(a<0)continue;u([...n.slice(0,a),...n.slice(a+1)].map(e=>eR(t,e)).filter(e=>Boolean(e)))}}let o=Array.from(r);return ei(`[ADDITIONAL_BASES] Token ${e?.symbol}, bases from guages: [${o.map(e=>e.symbol).join(",")}]`),o},e=>`${e?.chainId}_${e?.wrapped.address}`),eW=(e,t)=>{if(!e||!t||e.chainId!==t.chainId||e.wrapped.equals(t.wrapped))return`${e?.chainId}_${e?.wrapped?.address}_${t?.wrapped?.address}`;let[n,a]=e.wrapped.sortsBefore(t.wrapped)?[e.wrapped,t.wrapped]:[t.wrapped,e.wrapped];return`${n.chainId}_${n.address}_${a.address}`},eL=f((e,t)=>{let n=e?.chainId;if(!n||!e||!t||!ee(e,t))return[];let[a,r]=n?[(0,i.pu)(e,n),(0,i.pu)(t,n)]:[void 0,void 0];if(!a||!r)return[];let u=i.lM[n]??[];return[...u,...function(e,t){let n=e?.chainId,a={...n?i.ck[n]??{}:{}},r=e=>T(e,e=>e.address),u=e&&n?r([...a[e.wrapped.address]||[],...eU(e)])??[]:[],s=t&&n?r([...a[t.wrapped.address]||[],...eU(t)])??[]:[];return[...u,...s]}(e,t)]},eW),e$=f((e,t)=>{let n=e?.chainId;if(!n||!e||!t||!ee(e,t))return[];let[a,r]=n?[(0,i.pu)(e,n),(0,i.pu)(t,n)]:[void 0,void 0];if(!a||!r)return[];let u=eL(e,t),s=m(u,e=>u.map(t=>[e,t]));return[[a,r],...u.map(e=>[a,e]),...u.map(e=>[r,e]),...s].filter(e=>Boolean(e[0]&&e[1])).filter(([e,t])=>!e.equals(t)).filter(([e,t])=>{if(!n)return!0;let a=i.IP[n],r=a?.[e.wrapped.address],u=a?.[t.wrapped.address];return!r&&!u||(!r||!!r.find(e=>t.equals(e)))&&(!u||!!u.find(t=>e.equals(t)))})},eW),eG=(e,t)=>{let n=new Set,a=m(e,({pools:e})=>e.map(z));for(let e of a)n.add(e);for(let e of t){let{pools:t}=e,a=t.map(z);if(!a.some(e=>n.has(e)))return e}return null};function eF(e,t,n){let a=C(String(n),e),r=C("1",t);if(r&&a)return new s.tA({baseAmount:r,quoteAmount:a})}async function ez({gasPriceWei:e,poolProvider:t,quoteCurrency:n,blockNumber:a,quoteCurrencyUsdPrice:r,nativeCurrencyUsdPrice:u}){let{chainId:o}=n,p=J(o);if(!p)throw Error(`No valid usd token found on chain ${o}`);let l=H(o);if(!l)throw Error(`Unsupported chain ${o}. Native wrapped token not found.`);let d=BigInt("function"==typeof e?await e():e),[c,y]=await Promise.all([eV(t,o,a),ej(t,n,a)]),m=r?eF(p,n,r):void 0,f=u?eF(p,l,u):void 0,T=m&&f?f.multiply(m.invert()):void 0,g=({pools:e},{initializedTickCrossedList:t})=>{let a=l.equals(n.wrapped),r=BigInt(Math.max(1,k(t))),u=new Set,m=0n;for(let t of e){let{type:e}=t;if(_(t)){if(!u.has(e)){m+=i.HZ,u.add(e);continue}m+=i.rA;continue}if(U(t)){u.has(e)||(m+=(0,i.Pl)(o),u.add(e)),m+=(0,i.oc)(o);continue}if(W(t)){if(!u.has(e)){m+=i.qI,u.add(e);continue}m+=i.t$;continue}}let g=(0,i.Z$)(o)*r,h=0n*i.h0;m=m+g+h;let w=d*m,b=s.ih.fromRawAmount(l,w),A=s.ih.fromRawAmount(n.wrapped,0),v=s.ih.fromRawAmount(p,0);try{if(a&&(A=b),!a){let e=T||y&&j(y,l,n.wrapped);e&&(A=e.quote(b))}let e=f||c&&j(c,l,p);e&&(v=e.quote(b))}catch(e){}return{gasEstimate:m,gasCostInToken:A,gasCostInUSD:v}};return{estimateGasCost:g}}async function ej(e,t,n){let a=H(t.chainId);if(!a||t.wrapped.equals(a))return null;let r=await e.getCandidatePools({blockNumber:n,pairs:[[a,t]],currencyA:a,currencyB:t});return r[0]??null}async function eV(e,t,n){let a=J(t),r=H(t);if(!a||!r)return null;let i=await e.getCandidatePools({blockNumber:n,pairs:[[r,a]],currencyA:r,currencyB:a});return i[0]??null}async function eD({amount:e,baseRoutes:t,distributionPercent:n,quoteProvider:a,tradeType:r,blockNumber:i,gasModel:u,quoterOptimization:o=!0,signal:p}){let[l,d]=function(e,t){let n=[],a=[];for(let r=1;r<=100/t;r++)n.push(r*t),a.push(e.multiply(new s.iA(r*t,100)));return[n,a]}(e,n),c=d.reduce((e,n,a)=>[...e,...t.map(e=>({...e,amount:n,percent:l[a]}))],[]),y=r===s.YL.EXACT_INPUT?a.getRouteWithQuotesExactIn:a.getRouteWithQuotesExactOut;if(!o)return y(c,{blockNumber:i,gasModel:u,signal:p});let m="undefined"==typeof window?setTimeout:window.requestIdleCallback||window.setTimeout;eu.metric("Get quotes","from",c.length,"routes",c);let f=e=>new Promise((t,n)=>{m(async()=>{try{let n=await y(e,{blockNumber:i,gasModel:u,signal:p});t(n)}catch(e){n(e)}})}),T=P(c,10),g=await Promise.all(T.map(f)),h=g.reduce((e,t)=>[...e,...t],[]);return eu.metric("Get quotes","success, got",h.length,"quoted routes",h),h}var eH={topN:2,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:3},eQ={[u.a_.BSC]:{topN:2,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:4},[u.a_.BSC_TESTNET]:{topN:2,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:4},[u.a_.ETHEREUM]:{topN:2,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:4},[u.a_.GOERLI]:{topN:2,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:4}},eX={[u.a_.BSC]:{topN:3,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:3},[u.a_.BSC_TESTNET]:{topN:3,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:3},[u.a_.ETHEREUM]:{topN:3,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:3},[u.a_.GOERLI]:{topN:3,topNDirectSwaps:2,topNTokenInOut:2,topNSecondHop:1,topNWithEachBaseToken:3,topNWithBaseToken:3}},eZ={[u.a_.BSC]:{[y.ds.ankr.address]:{topNTokenInOut:4},[y.ds.ankrbnb.address]:{topNTokenInOut:4},[y.ds.ankrETH.address]:{topNTokenInOut:4},[y.ds.wbeth.address]:{topNSecondHop:3}}},eY={[u.a_.BSC]:{"0x701F1ed50Aa5e784B8Fb89d1Ba05cCCd627839a7":{topNTokenInOut:4}}},eK={[u.a_.POLYGON_ZKEVM]:{distributionPercent:50},[u.a_.ZKSYNC]:{distributionPercent:20},[u.a_.BASE]:{distributionPercent:10}};async function eJ(e,t,n,a){let{blockNumber:r}=a,i="function"==typeof r?await r():r,u=await e0(e,t,n,{...a,blockNumber:i});if(!u||u.outputAmount.equalTo(s.xE))throw Error("Cannot find a valid swap route");let{routes:o,gasEstimateInUSD:p,gasEstimate:l,inputAmount:d,outputAmount:c}=u;return{tradeType:n,routes:o,gasEstimate:l,gasEstimateInUSD:p,inputAmount:d,outputAmount:c,blockNumber:i}}async function e0(e,t,n,a){let{chainId:r}=t,{maxHops:u=3,maxSplits:o=4,distributionPercent:p=5,poolProvider:l,quoteProvider:d,blockNumber:c,gasPriceWei:y,allowedPoolTypes:m,quoterOptimization:f,quoteCurrencyUsdPrice:T,nativeCurrencyUsdPrice:g,signal:h}={...a,...eK[r]||{}},w=n===s.YL.EXACT_INPUT,b=w?e.currency:t,A=w?t:e.currency,k=await l?.getCandidatePools({currencyA:e.currency,currencyB:t,blockNumber:c,protocols:m,signal:h}),P=function(e,t,n,a=3){eu.metric("Computing routes from",n.length,"pools");let r=Array(n.length).fill(!1),i=[],u=(e,t,s,o)=>{if(!(s.length>a)){if(s.length>0&&L(s[s.length-1],t)){i.push(X([...s],e,t));return}for(let a=0;a<n.length;a++){if(r[a])continue;let i=n[a],p=o||e;if(!L(i,p))continue;let l=$(i,p);e.wrapped.equals(l.wrapped)||(s.push(i),r[a]=!0,u(e,t,s,l),r[a]=!1,s.pop())}}};return u(e,t,[]),eu.metric("Computed routes from",n.length,"pools",i.length,"routes"),i}(b,A,k,u);n===s.YL.EXACT_OUTPUT&&(P=P.filter(({type:e})=>3!==e));let S=await ez({gasPriceWei:y,poolProvider:l,quoteCurrency:t,blockNumber:c,quoteCurrencyUsdPrice:T,nativeCurrencyUsdPrice:g}),q=await eD({amount:e,baseRoutes:P,distributionPercent:p,quoteProvider:d,tradeType:n,blockNumber:c,gasModel:S,quoterOptimization:f,signal:h});return function(e,t,n,a,r){let u=e.currency.chainId,o=[],p={};for(let e of n)p[e.percent]||(p[e.percent]=[],o.push(e.percent)),p[e.percent].push(e);let l=function(e,t,n,a,r,{maxSplits:u=4,minSplits:o=0}){let p,l;let d=v(t,t=>t.sort((t,n)=>e===s.YL.EXACT_INPUT?r(t).greaterThan(r(n))?-1:1:r(t).lessThan(r(n))?-1:1)),c=e===s.YL.EXACT_INPUT?(e,t)=>e.greaterThan(t):(e,t)=>e.lessThan(t),y=e=>{let t=e[0];for(let n=1;n<e.length;n++)t=t.add(e[n]);return t},m=new I(Array,(e,t)=>c(e.quote,t.quote)?-1:1,3);if(!d[100]||o>1)eu.log({percentToSortedQuotes:v(d,e=>e.length)},"Did not find a valid route without any splits. Continuing search anyway.");else for(let e of(p=r(d[100][0]),l=[d[100][0]],d[100].slice(0,5)))m.push({quote:r(e),routes:[e]});let f=new E;for(let e=n.length;e>=0;e--){let t=n[e];d[t]&&(f.enqueue({curRoutes:[d[t][0]],percentIndex:e,remainingPercent:100-t,special:!1}),d[t]&&d[t][1]&&f.enqueue({curRoutes:[d[t][1]],percentIndex:e,remainingPercent:100-t,special:!0}))}let T=1;for(;f.size>0;){eu.log({top5:Array.from(m.consume()).map(e=>`${e.quote.toExact()} (${e.routes.map(e=>`${e.percent}% ${e.amount.toExact()} ${e.pools.map(e=>_(e)?`V2 ${e.reserve0.currency.symbol}-${e.reserve1.currency.symbol}`:U(e)?`V3 fee ${e.fee} ${e.token0.symbol}-${e.token1.symbol}`:`Stable ${e.balances.map(e=>e.currency).join("-")}`).join(", ")} ${e.quote.toExact()}`).join(", ")})`),onQueue:f.size},`Top 3 with ${T} splits`),m.clear();let t=f.size;if(++T>=3&&l&&l.length<T-1)break;if(T>u){eu.log("Max splits reached. Stopping search.");break}for(;t>0;){t--;let{remainingPercent:a,curRoutes:i,percentIndex:u,special:g}=f.dequeue();for(let t=u;t>=0;t--){let u=n[t];if(u>a||!d[u])continue;let h=d[u],w=eG(i,h);if(!w)continue;let b=a-u,A=[...i,w];if(0===b&&T>=o){let t=A.map(e=>r(e)),n=y(t),a=s.ih.fromRawAmount(n.currency,0),i=e===s.YL.EXACT_INPUT?n.subtract(a):n.add(a);m.push({quote:i,routes:A}),(!p||c(i,p))&&(p=i,l=A)}else f.enqueue({curRoutes:A,remainingPercent:b,percentIndex:t,special:g})}}}if(!l)return eu.log("Could not find a valid swap"),null;let g=y(l.map(e=>e.quoteAdjustedForGas)),h=l.map(e=>e.gasEstimate).reduce((e,t)=>e+t,0n);if(!i.R[a]||!i.R[a][0])throw Error(`Could not find a USD token for computing gas costs on ${a}`);let w=i.R[a][0],b=w.decimals,A={gasUsedL1:0n,gasCostL1USD:s.ih.fromRawAmount(w,0),gasCostL1QuoteToken:s.ih.fromRawAmount(l[0]?.quote.currency.wrapped,0)},{gasCostL1USD:k,gasCostL1QuoteToken:P}=A,S=l.map(e=>{let t=b-e.gasCostInUSD.currency.decimals;return 0===t?s.ih.fromRawAmount(w,e.gasCostInUSD.quotient):s.ih.fromRawAmount(w,e.gasCostInUSD.quotient*10n**BigInt(t))}),q=y(S);if(q.currency.equals(k.currency))q=q.add(k);else{let e=b-k.currency.decimals;q=q.add(s.ih.fromRawAmount(w,k.quotient*10n**BigInt(e)))}let M=y(l.map(e=>e.gasCostInToken)).add(P),N=y(l.map(e=>e.quote));if(e===s.YL.EXACT_INPUT){let e=g.subtract(P);g=e}else{let e=g.add(P);g=e}let B=l.sort((e,t)=>t.amount.greaterThan(e.amount)?1:-1);return{quote:N,quoteGasAdjusted:g,estimatedGasUsed:h,estimatedGasUsedUSD:q,estimatedGasUsedQuoteToken:M,routes:B}}(a,p,o.sort((e,t)=>e-t),u,e=>e.quoteAdjustedForGas,r);if(!l)return null;let{routes:d}=l,c=d.reduce((e,t)=>e.add(t.amount),s.ih.fromRawAmount(d[0].amount.currency,0)),y=e.subtract(c);y.greaterThan(0)&&(eu.log("Optimal route's amounts did not equal exactIn/exactOut total. Adding missing amount to last route in array.",{missingAmount:y.quotient.toString()}),d[d.length-1].amount=d[d.length-1].amount.add(y)),eu.log({routes:d,numSplits:d.length,amount:e.toExact(),quote:l.quote.toExact(),quoteGasAdjusted:l.quoteGasAdjusted.toFixed(Math.min(l.quoteGasAdjusted.currency.decimals,2)),estimatedGasUSD:l.estimatedGasUsedUSD.toFixed(Math.min(l.estimatedGasUsedUSD.currency.decimals,2)),estimatedGasToken:l.estimatedGasUsedQuoteToken.toFixed(Math.min(l.estimatedGasUsedQuoteToken.currency.decimals,2))},`Found best swap route. ${d.length} split.`);let{routes:m,quote:f,estimatedGasUsed:T,estimatedGasUsedUSD:g}=l,h=s.ih.fromRawAmount(t,f.quotient),w=a===s.YL.EXACT_INPUT;return{routes:m.map(({type:e,amount:n,quote:a,pools:r,path:i,percent:u})=>{let o=s.ih.fromRawAmount(t,a.quotient);return{percent:u,type:e,pools:r,path:i,inputAmount:w?n:o,outputAmount:w?o:n}}),gasEstimate:T,gasEstimateInUSD:g,inputAmount:w?e:h,outputAmount:w?h:e}}(e,t,q,n,{maxSplits:o})}function e2(e,t=6){return e&&0n!==e.denominator?e.greaterThan(10n**BigInt(t))?e.toFixed(0):e.toSignificant(t):void 0}function e1(e){return async function(...t){let n=e.length;if(0===n)throw Error("No valid calls");for(let[a,{timeout:r=2e3,asyncFn:i}]of e.entries()){let e=a<n-1?function(e,t){return function(...n){return Promise.race([e(...n),new Promise((e,n)=>{setTimeout(()=>n(Error(`Request timeout ${t}ms`)),t)})])}}(i,r):i;try{let n=await e(...t);return n}catch(e){if(a===n-1)throw e;eu.error("Call failed with error %O, try next fallback",e)}}throw Error("Unexpected end of call")}}function e6(e,t){let{fallbacks:n=[],fallbackTimeout:a=3e3}=t||{};return e1([e,...n].map(e=>({asyncFn:e,timeout:a})))}var e5=S.gql`
  query getTokens($pageSize: Int!, $tokenAddrs: [ID!]) {
    tokens(first: $pageSize, where: { id_in: $tokenAddrs }) {
      id
      derivedUSD
    }
  }
`;function e3(e){return async function({currencyA:t,currencyB:n,...a}){let r=eL(t,n);if(!r)return null;let i=new Map,u={},s=r.map(e=>{let t=(0,l.K)(e.address);return u[t]=e,t}),o=await e({addresses:s,chainId:t?.chainId,...a});for(let{address:e,priceUSD:t}of o){let n=u[(0,l.K)(e)];n&&i.set(n.wrapped.address,parseFloat(t)||0)}return i}}var e9=async({addresses:e,chainId:t,provider:n})=>{let a=n?.({chainId:t});if(!a)throw Error("No valid subgraph data provider");let{tokens:r}=await a.request(e5,{pageSize:1e3,tokenAddrs:e.map(e=>e.toLocaleLowerCase())});return r.map(({id:e,derivedUSD:t})=>({address:e,priceUSD:t}))},e4=e3(e9),e8=({endpoint:e})=>{let t=new Map;return async({addresses:n,chainId:a})=>{if(!a||!(0,u._X)(a))return[];let[r,i]=n.reduce(([e,n],a)=>{let r=t.get(a);return r?e.push(r):n.push(a),[e,n]},[[],[]]);if(!i.length)return r;let s=i.map(e=>`${(0,u._X)(a)}:${e.toLocaleLowerCase()}`).join(","),o=await fetch(`${e}/${s}`).then(e=>e.json()),{coins:p={}}=o;return[...r,...Object.entries(p).map(([e,n])=>{let[,a]=e.split(":"),r={address:a,priceUSD:n.price};return t.set((0,l.K)(a),r),r})]}},e7=e3(e8({endpoint:"https://coins.llama.fi/prices/current"})),te=e3(e8({endpoint:"https://wallet-api.pancakeswap.com/v1/prices"})),tt=e1([{asyncFn:({currencyA:e,currencyB:t})=>e7({currencyA:e,currencyB:t}),timeout:3e3},{asyncFn:({currencyA:e,currencyB:t})=>te({currencyA:e,currencyB:t}),timeout:3e3},{asyncFn:({currencyA:e,currencyB:t,v3SubgraphProvider:n})=>e4({currencyA:e,currencyB:t,provider:n})}]),tn=ti({abi:i.xo,getPossiblePoolMetas:([e,t])=>[{address:F(e.wrapped,t.wrapped),currencyA:e,currencyB:t}],buildPoolInfoCalls:({address:e})=>[{address:e,functionName:"getReserves",args:[]}],buildPool:({currencyA:e,currencyB:t},[n])=>{if(!n)return null;let[a,r]=n,[i,u]=e.wrapped.sortsBefore(t.wrapped)?[e,t]:[t,e];return{type:0,reserve0:s.ih.fromRawAmount(i,a.toString()),reserve1:s.ih.fromRawAmount(u,r.toString())}}}),ta=ti({abi:i.CU,getPossiblePoolMetas:([e,t])=>{let n=(0,w.vD)(e.chainId);return n.filter(({token:n,quoteToken:a})=>{let r=(0,q.iG)(n),i=(0,q.iG)(a);return r.equals(e.wrapped)&&i.equals(t.wrapped)||r.equals(t.wrapped)&&i.equals(e.wrapped)}).map(({stableSwapAddress:n})=>({address:n,currencyA:e,currencyB:t}))},buildPoolInfoCalls:({address:e})=>[{address:e,functionName:"balances",args:[0]},{address:e,functionName:"balances",args:[1]},{address:e,functionName:"A",args:[]},{address:e,functionName:"fee",args:[]},{address:e,functionName:"FEE_DENOMINATOR",args:[]}],buildPool:({currencyA:e,currencyB:t,address:n},[a,r,i,u,o])=>{if(!a||!r||!i||!u||!o)return null;let[p,l]=e.wrapped.sortsBefore(t.wrapped)?[e,t]:[t,e];return{address:n,type:2,balances:[s.ih.fromRawAmount(p,a.toString()),s.ih.fromRawAmount(l,r.toString())],amplifier:BigInt(i.toString()),fee:new s.gG(BigInt(u.toString()),BigInt(o.toString()))}}}),tr=ti({abi:g.XH,getPossiblePoolMetas:([e,t])=>{let n=g.zF[e.chainId];return n?[g.lk.LOWEST,g.lk.LOW,g.lk.MEDIUM,g.lk.HIGH].map(a=>({address:G({deployerAddress:n,tokenA:e.wrapped,tokenB:t.wrapped,fee:a}),currencyA:e,currencyB:t,fee:a})):[]},buildPoolInfoCalls:({address:e,currencyA:t,currencyB:n})=>[{address:e,functionName:"liquidity"},{address:e,functionName:"slot0"},{abi:s.em,address:t.wrapped.address,functionName:"balanceOf",args:[e]},{abi:s.em,address:n.wrapped.address,functionName:"balanceOf",args:[e]}],buildPool:({currencyA:e,currencyB:t,fee:n,address:a},[r,i,u,o])=>{if(!i)return null;let[p,l,,,,d]=i,c=e.wrapped.sortsBefore(t.wrapped),[y,m]=c?[u,o]:[o,u],[f,T]=c?[e,t]:[t,e],[h,w]=(0,g.BS)(d);return{type:1,token0:f,token1:T,reserve0:s.ih.fromRawAmount(f,y),reserve1:s.ih.fromRawAmount(T,m),fee:n,liquidity:BigInt(r.toString()),sqrtRatioX96:BigInt(p.toString()),tick:Number(l),address:a,token0ProtocolFee:h,token1ProtocolFee:w}}});function ti({abi:e,getPossiblePoolMetas:t,buildPoolInfoCalls:n,buildPool:a}){return async function(r,i,u){if(!i)throw Error("No valid onchain data provider");let s=r[0]?.[0]?.chainId,o=i({chainId:s});if(!s||!o)return[];let p=new Set,l=[];for(let e of r){let n=t(e);for(let e of n)p.has(e.address)||(l.push(e),p.add(e.address))}let d=[],c=0;for(let e of l){let t=n(e);if(c||(c=t.length),!c||c!==t.length)throw Error("Inconsistent pool data call");d=[...d,...t]}if(!d.length)return[];let y=await o.multicall({contracts:d.map(t=>({abi:t.abi||e,address:t.address,functionName:t.functionName,args:t.args})),allowFailure:!0,blockNumber:u?BigInt(Number(BigInt(u))):void 0}),m=[];for(let e=0;e<l.length;e+=1){let t=y.slice(e*c,(e+1)*c),n=a(l[e],t.map(e=>e.result));n&&m.push(n)}return m}}function tu(e,t){if(!t)return e;let n={...e},a=Object.keys(n);for(let e of a)n[e]=Math.max(n[e],t[e]||0);return n}function ts(e,t){return function(n,a){let r=n?.chainId;if(!r||!e[r])return eH;let i=t[r]?.[n?.wrapped?.address||"0x"],u=t[r]?.[a?.wrapped?.address||"0x"];return tu(tu(e[r],i),u)}}var to=ts(eQ,eZ),tp=ts(eX,eY),tl=(e,t)=>e.tvlUSD>=t.tvlUSD?-1:1;function td({getPoolSelectorConfig:e,getToken0:t,getToken1:n,getPoolAddress:a}){return function(r,u,o){let p=e(r,u);if(!r||!u||!o.length)return[];let l=o.sort(tl),{chainId:d}=t(l[0]),c=i.lM[d]??[],y=new Set,m=e=>{for(let t of e)y.add(a(t))},f=c.map(e=>l.filter(a=>t(a).wrapped.equals(e)&&n(a).wrapped.equals(r.wrapped)||n(a).wrapped.equals(e)&&t(a).wrapped.equals(r.wrapped)).sort(tl).slice(0,p.topNWithEachBaseToken)).reduce((e,t)=>[...e,...t],[]).sort(tl).slice(0,p.topNWithBaseToken);m(f);let T=c.map(e=>l.filter(r=>!y.has(a(r))&&(t(r).wrapped.equals(e)&&n(r).wrapped.equals(u.wrapped)||n(r).wrapped.equals(e)&&t(r).wrapped.equals(u.wrapped))).sort(tl).slice(0,p.topNWithEachBaseToken)).reduce((e,t)=>[...e,...t],[]).sort(tl).slice(0,p.topNWithBaseToken);m(T);let g=l.filter(e=>!y.has(a(e))&&(t(e).wrapped.equals(r.wrapped)&&n(e).wrapped.equals(u.wrapped)||n(e).wrapped.equals(r.wrapped)&&t(e).wrapped.equals(u.wrapped))).slice(0,p.topNDirectSwaps);m(g);let h=s.FX[d],w=h?l.filter(e=>!y.has(a(e))&&(t(e).wrapped.equals(h)&&n(e).wrapped.equals(r.wrapped)||n(e).wrapped.equals(h)&&t(e).wrapped.equals(r.wrapped))).slice(0,1):[];m(w);let b=h?l.filter(e=>!y.has(a(e))&&(t(e).wrapped.equals(h)&&n(e).wrapped.equals(u.wrapped)||n(e).wrapped.equals(h)&&t(e).wrapped.equals(u.wrapped))).slice(0,1):[];m(b);let A=l.slice(0,p.topN).filter(e=>!y.has(a(e)));m(A);let v=l.filter(e=>!y.has(a(e))&&(t(e).wrapped.equals(r.wrapped)||n(e).wrapped.equals(r.wrapped))).slice(0,p.topNTokenInOut);m(v);let I=l.filter(e=>!y.has(a(e))&&(t(e).wrapped.equals(u.wrapped)||n(e).wrapped.equals(u.wrapped))).slice(0,p.topNTokenInOut);m(I);let E=(e,r)=>e.map(e=>t(e).wrapped.equals(r.wrapped)?n(e):t(e)).map(e=>l.filter(r=>!y.has(a(r))&&(t(r).wrapped.equals(e.wrapped)||n(r).wrapped.equals(e.wrapped)))).reduce((e,t)=>[...e,...t],[]).reduce((e,t)=>e.some(e=>e===t)?e:[...e,t],[]).sort(tl).slice(0,p.topNSecondHop),k=E([...v,...f],r);m(k);let P=E([...I,...T],u);m(P);let S=[...f,...T,...g,...w,...b,...A,...v,...I,...k,...P];return S.map(({tvlUSD:e,...t})=>t)}}var tc=td({getPoolSelectorConfig:to,getToken0:e=>e.token0,getToken1:e=>e.token1,getPoolAddress:e=>e.address}),ty=td({getPoolSelectorConfig:tp,getToken0:e=>e.reserve0.currency,getToken1:e=>e.reserve1.currency,getPoolAddress:e=>z(e)||"0x"});function tm({id:e,getPoolMetas:t,getPoolsFromSubgraph:n}){return async function({provider:a,pairs:r}){if(!a)throw Error("No valid subgraph data provider");let i=r[0]?.[0]?.chainId;if(!i)return[];let u=a({chainId:i});if(!u)return eu.error("No subgraph client found for chainId",i),[];er(`SUBGRAPH_POOLS_START(${e})`,r);let s=new Map;for(let e of r){let n=t(e);for(let e of n)s.set(e.address.toLocaleLowerCase(),e)}let o=Array.from(s.keys()),p=await n({addresses:o,getPoolMetaByAddress:e=>s.get(e.toLocaleLowerCase())??null,client:u});return er(`SUBGRAPH_POOLS_END(${e})`,p),p.filter(e=>!!e)}}var tf=f(([e,t,n])=>({address:g.Kg.getAddress(e.wrapped,t.wrapped,n),currencyA:e,currencyB:t,fee:n}),([e,t,n])=>{if(e.wrapped.equals(t.wrapped))return[e.chainId,e.wrapped.address,n].join("_");let[a,r]=e.wrapped.sortsBefore(t.wrapped)?[e.wrapped,t.wrapped]:[t.wrapped,e.wrapped];return[a.chainId,a.address,r.address,n].join("_")}),tT=f(e=>[g.lk.LOWEST,g.lk.LOW,g.lk.MEDIUM,g.lk.HIGH].map(t=>tf([...e,t])),([e,t])=>{if(e.wrapped.equals(t.wrapped))return[e.chainId,e.wrapped.address].join("_");let[n,a]=e.wrapped.sortsBefore(t.wrapped)?[e.wrapped,t.wrapped]:[t.wrapped,e.wrapped];return[n.chainId,n.address,a.address].join("_")}),tg=S.gql`
  query getPools($pageSize: Int!, $poolAddrs: [String]) {
    pools(first: $pageSize, where: { id_in: $poolAddrs }) {
      id
      tick
      sqrtPrice
      feeTier
      liquidity
      feeProtocol
      totalValueLockedUSD
    }
  }
`,th=tm({id:"V3",getPoolMetas:tT,getPoolsFromSubgraph:async({addresses:e,getPoolMetaByAddress:t,client:n})=>{let{pools:a}=await n.request(tg,{pageSize:1e3,poolAddrs:e});return a.map(({id:e,liquidity:n,sqrtPrice:a,tick:r,totalValueLockedUSD:i,feeProtocol:u})=>{let s=t(e);if(!s)return null;let{fee:o,currencyA:p,currencyB:l,address:d}=s,[c,y]=p.wrapped.sortsBefore(l.wrapped)?[p,l]:[l,p],[m,f]=(0,g.BS)(u);return{type:1,fee:o,token0:c,token1:y,liquidity:BigInt(n),sqrtRatioX96:BigInt(a),tick:Number(r),address:d,tvlUSD:BigInt(Number.parseInt(i)),token0ProtocolFee:m,token1ProtocolFee:f}})}}),tw=S.gql`
  query getPools($pageSize: Int!, $poolAddrs: [ID!]) {
    pairs(first: $pageSize, where: { id_in: $poolAddrs }) {
      id
      reserve0
      reserve1
      reserveUSD
    }
  }
`,tb=tm({id:"V2",getPoolMetas:([e,t])=>[{currencyA:e,currencyB:t,address:F(e.wrapped,t.wrapped)}],getPoolsFromSubgraph:async({addresses:e,getPoolMetaByAddress:t,client:n})=>{let{pairs:a}=await n.request(tw,{pageSize:1e3,poolAddrs:e});return a.map(({id:e,reserveUSD:n,reserve0:a,reserve1:r})=>{let i=t(e);if(!i)return null;let{currencyA:u,currencyB:s,address:o}=i,[p,l]=u.wrapped.sortsBefore(s.wrapped)?[u,s]:[s,u],d=C(a,p),c=C(r,l);return d&&c?{address:o,type:0,reserve0:d,reserve1:c,tvlUSD:BigInt(Number.parseInt(n))}:null})}}),tA=S.gql`
  query getPools($pageSize: Int!, $id: String) {
    pools(first: $pageSize, where: { id_gt: $id }) {
      id
      tick
      token0 {
        symbol
        id
        decimals
      }
      token1 {
        symbol
        id
        decimals
      }
      sqrtPrice
      feeTier
      liquidity
      feeProtocol
      totalValueLockedUSD
    }
  }
`,tv=function({getPoolsFromSubgraph:e,getPoolId:t}){return async function({provider:n,chainId:a,pageSize:r=1e3}){if(!n||!a)throw Error("No valid subgraph data provider");let i=n({chainId:a});if(!i)throw Error(`No subgraph client found for chainId ${a}`);let u=!0,s="",o=[];for(;u;){let n=await e({client:i,lastId:s,pageSize:r,chainId:a});if(n.length<r){u=!1,o=[...o,...n];break}s=t(n[n.length-1]),o=[...o,...n]}return o}}({id:"getAllV3PoolsFromSubgraph",getPoolsFromSubgraph:async({lastId:e,pageSize:t,client:n,chainId:a})=>{let{pools:r}=await n.request(tA,{pageSize:t,id:e});return r.map(({id:e,liquidity:t,sqrtPrice:n,tick:r,totalValueLockedUSD:i,feeProtocol:u,token0:o,token1:p,feeTier:d})=>{let[c,y]=(0,g.BS)(u);return{type:1,fee:Number(d),token0:new s.WU(a,(0,l.K)(o.id),Number(o.decimals),o.symbol),token1:new s.WU(a,(0,l.K)(p.id),Number(p.decimals),p.symbol),liquidity:BigInt(t),sqrtRatioX96:BigInt(n),tick:Number(r),address:(0,l.K)(e),tvlUSD:BigInt(Number.parseInt(i)),token0ProtocolFee:c,token1ProtocolFee:y}})},getPoolId:e=>e.address});function tI(e){return async function({currencyA:t,currencyB:n,pairs:a,onChainProvider:r,blockNumber:i,...u}){let o=a||e$(t,n),[p,l]=await Promise.all([tn(o,r,i),e({currencyA:t,currencyB:n,...u})]);if(!p)throw Error("Failed to get v2 candidate pools");return l?p.map(e=>{let t=t=>{if(t.equalTo(s.xE))return 0;let n=l.get(t.currency.wrapped.address);if(void 0!==n)return parseFloat(t.toExact())*n;let a=e.reserve0.currency.equals(t.currency)?e.reserve1:e.reserve0,r=l.get(a.currency.wrapped.address);if(r){let e=new s.tA({baseAmount:t,quoteAmount:a});return parseFloat(t.toExact())*parseFloat(function(e,t){if(e)return e2(e?.asFraction.multiply(e?.scalar),6)}(e,0)||"0")}return 0};return{...e,tvlUSD:BigInt(Math.floor(t(e.reserve0)+t(e.reserve1))),address:z(e)}}):(eu.log("Failed to get base token prices"),p.map(e=>({...e,tvlUSD:BigInt(0),address:z(e)})))}}var tE=tI(tt);function tk(e,t){let n=e6(e,t);return async function(e){let{currencyA:t,currencyB:a}=e,r=await n(e);return ty(t,a,r)}}async function tP(e){let t=tk(tE,{fallbacks:[({pairs:e,currencyA:t,currencyB:n,v2SubgraphProvider:a})=>{let r=e||e$(t,n);return tb({provider:a,pairs:r})}],fallbackTimeout:3e3});return t(e)}var tS=f((e,t)=>{let n=e.find(e=>e.address===t);return n?.tvlUSD||0n},(e,t)=>t),tq=e=>async function(t){let{currencyA:n,currencyB:a,pairs:r,onChainProvider:i,blockNumber:u}=t,s=r||e$(n,a),[o,p]=await Promise.allSettled([tr(s,i,u),e(t)]);if("fulfilled"===o.status&&"fulfilled"===p.status){let{value:e}=o,{value:t}=p;if(!Array.isArray(t))throw Error("Failed to get tvl references");return e.map(e=>{let n=BigInt(tS(t,e.address));return{...e,tvlUSD:n}})}throw Error(`Getting v3 pools failed. Onchain ${o.status}, tvl references ${p.status}`)},tM=tq(e=>{let{currencyA:t,currencyB:n,pairs:a,subgraphProvider:r}=e,i=a||e$(t,n);return th({provider:r,pairs:i})}),tN=tq((()=>{let e=new Map;return async t=>{let{currencyA:n}=t;if(!n?.chainId)throw Error(`Cannot get tvl references at chain ${n?.chainId}`);let a=e.get(n.chainId);if(a)return a;let r=await fetch(`https://routing-api.pancakeswap.com/v0/v3-pools-tvl/${n.chainId}`),i=await r.json();return e.set(n.chainId,i),i}})()),tB=tq(()=>Promise.resolve([]));function tx(e,t){let n=e6(e,t);return async function(e){let{currencyA:t,currencyB:a}=e,r=await n(e);return tc(t,a,r)}}async function tC(e){let{subgraphFallback:t=!0,staticFallback:n=!0,fallbackTimeout:a,...r}=e,i=[];t&&(i.push(tM),i.push(async e=>{let{currencyA:t,currencyB:n,pairs:a,subgraphProvider:r}=e,i=a||e$(t,n);return th({provider:r,pairs:i})})),n&&i.push(tB);let u=tx(tN,{fallbacks:i,fallbackTimeout:a});return u(r)}async function tR(e){let{onChainProvider:t,currencyA:n,currencyB:a,pairs:r,blockNumber:i}=e,u=r||e$(n,a);return ta(u,t,i)}async function tO({protocols:e=[1,0,2],v2SubgraphProvider:t,v3SubgraphProvider:n,...a}){let{currencyA:r}=a,i=r?.chainId;if(!i)return[];let u=await Promise.all(e.map(e=>0===e?tP({...a,v2SubgraphProvider:t,v3SubgraphProvider:n}):1===e?tC({...a,subgraphProvider:n}):tR(a)));return u.reduce((e,t)=>[...e,...t],[])}function t_({onChainProvider:e,v2SubgraphProvider:t,v3SubgraphProvider:n}){return{getCandidatePools:async a=>tO({...a,onChainProvider:e,v2SubgraphProvider:t,v3SubgraphProvider:n})}}function tU(e){let t=[0,2,1];return{getCandidatePools:async({protocols:n=t,pairs:a})=>{if(!e)return[];if(!a)return e.filter(e=>n.includes(e.type));let r=[];for(let[t,i]of a)for(let a of e)L(a,t)&&L(a,i)&&n.includes(a.type)&&r.push(a);return r}}}function tW(e){let t=t_(e);return t}function tL(){let e=(e=!0)=>{let t=t$(e),n=tG(e),a=tF(e),r=(t,n)=>e?t.subtract(n):t.add(n);return async function(i,{gasModel:u}){let o=[];for(let p of i)try{let{pools:i,amount:l}=p,d=l,c=Array(i.length).fill(0),y=!0;for(let[r,u]of function*(t){let n=e?0:t.length-1,a=()=>e?n<t.length:n>=0;for(;a();)yield[t[n],n],e?n+=1:n-=1}(i)){if(_(r)){[d]=t(r,d);continue}if(W(r)){[d]=n(r,d);continue}if(U(r)){let e=await a(r,d);if(!e||e.quote.quotient===s.xE){y=!1;break}let{quote:t,numOfTicksCrossed:n}=e;d=t,c[u]=n}}if(!y)continue;let{gasEstimate:m,gasCostInUSD:f,gasCostInToken:T}=u.estimateGasCost({...p,quote:d},{initializedTickCrossedList:c});o.push({...p,quote:d,quoteAdjustedForGas:r(d,T),gasEstimate:m,gasCostInUSD:f,gasCostInToken:T})}catch(e){}return o}};return{getRouteWithQuotesExactIn:e(!0),getRouteWithQuotesExactOut:e(!1)}}function t$(e=!0){return function(t,n){let{reserve0:a,reserve1:r}=t,i=new s.sO(a.wrapped,r.wrapped),[u,o]=e?i.getOutputAmount(n.wrapped):i.getInputAmount(n.wrapped),p={...t,reserve0:o.reserve0,reserve1:o.reserve1};return[u,p]}}function tG(e=!0){let t=e?w.RM:w.sP;return function(e,n){let{amplifier:a,balances:r,fee:i}=e,[u,{balances:s}]=t({amount:n,balances:r,amplifier:a,outputCurrency:$(e,n.currency),fee:i});return[u,{...e,balances:s}]}}function tF(e=!0){return async function(t,n){let{token0:a,token1:r,fee:i,sqrtRatioX96:u,liquidity:s,ticks:o,tick:p}=t;if(!o?.length)return null;try{let l=new g.Kg(a.wrapped,r.wrapped,i,u,s,p,o),[d,c]=e?await l.getOutputAmount(n.wrapped):await l.getInputAmountByExactOut(n.wrapped);if(d.quotient<=0n)return null;let{tickCurrent:y}=c,m={...t,tick:y,sqrtRatioX96:c.sqrtRatioX96,liquidity:c.liquidity},f=g.l$.countInitializedTicksCrossed(o,p,y);return{quote:d,numOfTicksCrossed:f,pool:m}}catch(e){return null}}}function tz(e=!0){let t=t$(e),n=tG(e),a=tF(e);return async function(e,r){if(_(e)){let[n,a]=t(e,r);return{quote:n,pool:e,poolAfter:a}}if(U(e)){let t=await a(e,r);return t?{quote:t.quote,pool:e,poolAfter:t.pool}:void 0}if(W(e)){let[t,a]=n(e,r);return{quote:t,pool:e,poolAfter:a}}}}function tj(e){return e instanceof Error&&"AbortError"===e.name}var tV=class{},tD=class extends tV{constructor(e,t,n=1e6){super(),this.chainId=e,this.provider=t,this.gasLimitPerCall=n,this.provider=t}async callSameFunctionOnMultipleContracts(e){let{addresses:t,functionName:n,functionParams:a,abi:r,additionalConfig:i}=e,u=i?.gasLimitPerCall??this.gasLimitPerCall,s=(0,p.R)({abi:r,functionName:n,args:a}),o=t.map(e=>({target:e,callData:s,gasLimit:BigInt(u)})),{results:l,blockNumber:c}=await (0,N.I6)(o,{gasLimit:i?.gasLimit,gasBuffer:i?.gasBuffer,dropUnexecutedCalls:i?.dropUnexecutedCalls,chainId:this.chainId,client:this.provider,signal:i?.signal}),y=[],m=[],f=[];for(let{result:e,success:t,gasUsed:a}of l){if("0x"===e||!t){y.push({success:!1,returnData:e}),f.push(Number(a));continue}try{y.push({success:!0,result:(0,d.k)({abi:r,functionName:n,data:e})}),m.push(Number(a))}catch(t){y.push({success:!1,returnData:e})}}return{blockNumber:c,results:y,approxGasUsedPerSuccessCall:B.percentile(m,99),approxGasUsedPerFailCall:B.percentile(f,99)}}async callSameFunctionOnContractWithMultipleParams(e){let{address:t,functionName:n,functionParams:a,abi:r,additionalConfig:i}=e,u=i?.gasLimitPerCall??this.gasLimitPerCall,s=a.map(e=>{let a=(0,p.R)({abi:r,functionName:n,args:e});return{target:t,callData:a,gasLimit:BigInt(u)}}),{results:o,blockNumber:l}=await (0,N.I6)(s,{gasLimit:i?.gasLimit,gasBuffer:i?.gasBuffer,dropUnexecutedCalls:i?.dropUnexecutedCalls,chainId:this.chainId,client:this.provider,signal:i?.signal}),c=[],y=[],m=[];for(let{result:e,success:t,gasUsed:a}of o){if("0x"===e||!t){c.push({success:!1,returnData:e}),m.push(Number(a));continue}try{c.push({success:!0,result:(0,d.k)({abi:r,functionName:n,data:e})}),y.push(Number(a))}catch(t){c.push({success:!1,returnData:e})}}return{blockNumber:l,results:c,approxGasUsedPerSuccessCall:B.percentile(y,99),approxGasUsedPerFailCall:B.percentile(m,99)}}async callMultipleFunctionsOnSameContract(e){let{address:t,functionNames:n,functionParams:a,additionalConfig:r,abi:i}=e,u=r?.gasLimitPerCall??this.gasLimitPerCall,s=n.map((e,n)=>{let r=(0,p.R)({abi:i,functionName:e,args:a?a[n]:[]});return{target:t,callData:r,gasLimit:BigInt(u)}}),{results:o,blockNumber:l}=await (0,N.I6)(s,{gasLimit:r?.gasLimit,gasBuffer:r?.gasBuffer,dropUnexecutedCalls:r?.dropUnexecutedCalls,chainId:this.chainId,client:this.provider,signal:r?.signal}),c=[],y=[],m=[];for(let[e,{result:t,success:a,gasUsed:r}]of o.entries()){if("0x"===t||!a){c.push({success:!1,returnData:t}),m.push(Number(r));continue}try{c.push({success:!0,result:(0,d.k)({abi:i,functionName:n[e],data:t})}),y.push(Number(r))}catch(e){c.push({success:!1,returnData:t})}}return{blockNumber:l,results:c,approxGasUsedPerSuccessCall:B.percentile(y,99),approxGasUsedPerFailCall:B.percentile(m,99)}}};tD.abi=[{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getEthBalance",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct PancakeInterfaceMulticall.Call[]",name:"calls",type:"tuple[]"}],name:"multicall",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"},{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"uint256",name:"gasUsed",type:"uint256"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct PancakeInterfaceMulticall.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}];var tH={[u.a_.BSC_TESTNET]:.1,[u.a_.BSC]:.1,[u.a_.ETHEREUM]:.1,[u.a_.GOERLI]:.1,[u.a_.ARBITRUM_ONE]:.1,[u.a_.ARBITRUM_GOERLI]:.1,[u.a_.POLYGON_ZKEVM]:.01,[u.a_.POLYGON_ZKEVM_TESTNET]:0,[u.a_.ZKSYNC]:.2,[u.a_.ZKSYNC_TESTNET]:.1,[u.a_.LINEA]:.1,[u.a_.LINEA_TESTNET]:.1,[u.a_.OPBNB]:.1,[u.a_.OPBNB_TESTNET]:.1,[u.a_.BASE]:.1,[u.a_.BASE_TESTNET]:.1,[u.a_.SCROLL_SEPOLIA]:.1,[u.a_.SEPOLIA]:.1,[u.a_.ARBITRUM_SEPOLIA]:.1,[u.a_.BASE_SEPOLIA]:.1},tQ=class extends Error{constructor(){super(...arguments),this.name="BlockConflictError"}},tX=class extends Error{constructor(){super(...arguments),this.name="SuccessRateError"}},tZ=class extends Error{constructor(){super(...arguments),this.name="ProviderBlockHeaderError"}},tY=class extends Error{constructor(){super(...arguments),this.name="ProviderTimeoutError"}},tK=class extends Error{constructor(){super(...arguments),this.name="ProviderGasError"}},tJ=({retries:e})=>{let t=[],n=e||0;return{shouldRetry:e=>!tj(e)&&n>0&&t.every(t=>t.name!==e.name),onRetry:e=>{t.push(e),n-=1},getErrorsOnPreviousRetries:()=>t}},t0=({isExactIn:e,quote:t,gasCostInToken:n})=>e?t.subtract(n):t.add(n);function t2({getQuoteFunctionName:e,getQuoterAddress:t,abi:n,getCallInputs:a}){return function({onChainProvider:r,gasLimit:o,multicallConfigs:p,onAdjustQuoteForGas:l=t0}){let d=(d=!0)=>{let c=e(d),y=({quote:e,gasCostInToken:t})=>l({quote:e,gasCostInToken:t,isExactIn:d});return async function(e,{blockNumber:l,gasModel:m,retry:f,signal:T}){if(!e.length)return[];let{amount:{currency:{chainId:g}}}=e[0],h=t(g),w=tH[g],b=p?.[g]||i.$Z[g]||i.$Z[u.a_.ETHEREUM],{defaultConfig:{gasLimitPerCall:A,dropUnexecutedCalls:v}}=b,I=r({chainId:g}),E={blockNumber:l},k=new tD(g,I,A),P=e.map(e=>a(e,d)),S={retries:2,minTimeout:25,maxTimeout:250,...f},{shouldRetry:q,onRetry:N}=tJ(S);async function B({gasLimitPerCall:e}){try{let{results:t,blockNumber:a,approxGasUsedPerSuccessCall:r}=await k.callSameFunctionOnContractWithMultipleParams({address:h,abi:n,functionName:c,functionParams:P,providerConfig:E,additionalConfig:{dropUnexecutedCalls:v,gasLimitPerCall:e,gasLimit:o,signal:T}}),i=function(e,t){let n=e.length,a=e.filter(e=>e.success).length,r=1*a/n;if(r<t)return new tX(`Quote success rate below threshold of ${t}: ${r}`)}(t,w);if(i)throw i;return{results:t,blockNumber:a,approxGasUsedPerSuccessCall:r}}catch(t){if(t instanceof tX||t instanceof tQ||tj(t))throw t;let e=t.message.slice(0,500);if(t.message.includes("header not found"))throw new tZ(e);if(t.message.includes("timeout"))throw new tY(`Request had ${P.length} inputs. ${e}`);if(t.message.includes("out of gas"))throw new tK(e);throw Error(`Unknown error from provider: ${e}`)}}let x=await M(async e=>{try{let e=await B({gasLimitPerCall:A});return e}catch(n){let t=n instanceof Error?n:Error(`Unexpected error type ${n}`);if(!q(t))return e(t);if(t instanceof tX){N(t);let{successRateFailureOverrides:e}=b;return B({gasLimitPerCall:e.gasLimitPerCall})}if(t instanceof tK){N(t);let{gasErrorFailureOverride:e}=b;return B({gasLimitPerCall:e.gasLimitPerCall})}throw t}},S);if(!x)throw Error(`Unexpected empty quote result ${x}`);let{results:C}=x,R=function(e,t,n,a){let r=[];for(let i=0;i<e.length;i+=1){let u=t[i],o=e[i];if(!o)continue;let{success:p}=o;if(!p)continue;let l=function({input:e,output:t},n){return n.equals(e)?t:e}(u,u.amount.currency),d=s.ih.fromRawAmount(l.wrapped,o.result[0].toString()),{gasEstimate:c,gasCostInToken:y,gasCostInUSD:m}=n.estimateGasCost({...u,quote:d},{initializedTickCrossedList:o.result[2]});r.push({...u,quote:d,quoteAdjustedForGas:a({quote:d,gasCostInToken:y}),gasEstimate:c,gasCostInToken:y,gasCostInUSD:m})}return r}(C,e,m,y);return R}};return{getRouteWithQuotesExactIn:d(!0),getRouteWithQuotesExactOut:d(!1)}}}var t1=t2({getQuoterAddress:e=>i.WL[e],getQuoteFunctionName:()=>"quoteExactInput",abi:[{inputs:[{internalType:"address",name:"_deployer",type:"address"},{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_factoryV2",type:"address"},{internalType:"address",name:"_factoryStable",type:"address"},{internalType:"address",name:"_WETH9",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"WETH9",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"deployer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factoryStable",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factoryV2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"int256",name:"amount0Delta",type:"int256"},{internalType:"int256",name:"amount1Delta",type:"int256"},{internalType:"bytes",name:"path",type:"bytes"}],name:"pancakeV3SwapCallback",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256[]",name:"flag",type:"uint256[]"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"quoteExactInput",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160[]",name:"v3SqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"v3InitializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"v3SwapGasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"flag",type:"uint256"}],internalType:"struct IMixedRouteQuoterV1.QuoteExactInputSingleStableParams",name:"params",type:"tuple"}],name:"quoteExactInputSingleStable",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"}],internalType:"struct IMixedRouteQuoterV1.QuoteExactInputSingleV2Params",name:"params",type:"tuple"}],name:"quoteExactInputSingleV2",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IMixedRouteQuoterV1.QuoteExactInputSingleV3Params",name:"params",type:"tuple"}],name:"quoteExactInputSingleV3",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"}],getCallInputs:(e,t)=>[V(e,!t),e.pools.map(e=>{if(U(e))return 0;if(_(e))return 1;if(W(e)){if(2===e.balances.length)return 2;if(3===e.balances.length)return 3}return -1}).filter(e=>e>=0),`0x${e.amount.quotient.toString(16)}`]}),t6=t2({getQuoterAddress:e=>i.qU[e],getQuoteFunctionName:e=>e?"quoteExactInput":"quoteExactOutput",abi:[{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"quoteExactInput",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160[]",name:"sqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"initializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoterV2.QuoteExactInputSingleParams",name:"params",type:"tuple"}],name:"quoteExactInputSingle",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256",name:"amountOut",type:"uint256"}],name:"quoteExactOutput",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160[]",name:"sqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"initializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoterV2.QuoteExactOutputSingleParams",name:"params",type:"tuple"}],name:"quoteExactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"}],getCallInputs:(e,t)=>[V(e,!t),`0x${e.amount.quotient.toString(16)}`]});function t5(e){let{onChainProvider:t,multicallConfigs:n,gasLimit:a}=e,r=tL(),i=t1({onChainProvider:t,multicallConfigs:n,gasLimit:a}),u=t6({onChainProvider:t,multicallConfigs:n,gasLimit:a}),s=(e=!0)=>{let t=e?r.getRouteWithQuotesExactIn:r.getRouteWithQuotesExactOut,n=e?i.getRouteWithQuotesExactIn:i.getRouteWithQuotesExactOut,a=e?u.getRouteWithQuotesExactIn:u.getRouteWithQuotesExactOut;return async function(e,{blockNumber:r,gasModel:i,signal:u}){let s=[],o=[],p=[],l=[];for(let t of e){if(0===t.type||2===t.type){l.push(t);continue}if(1===t.type){if(1===t.pools.length){s.push(t);continue}o.push(t);continue}let{pools:e}=t;if(e.some(e=>U(e))){p.push(t);continue}l.push(t)}let d=await Promise.allSettled([t(l,{blockNumber:r,gasModel:i,signal:u}),n(p,{blockNumber:r,gasModel:i,retry:{retries:0},signal:u}),a(s,{blockNumber:r,gasModel:i,signal:u}),a(o,{blockNumber:r,gasModel:i,retry:{retries:1},signal:u})]);if(d.every(e=>"rejected"===e.status))throw Error(d.map(e=>e.reason).join(","));return d.filter(e=>"fulfilled"===e.status).reduce((e,t)=>[...e,...t.value],[])}};return{getRouteWithQuotesExactIn:s(!0),getRouteWithQuotesExactOut:s(!1),getConfig:()=>e}}var t3={};(0,i.r2)(t3,{zPools:()=>no,zRouterGetParams:()=>np,zRouterPostParams:()=>nl});var t9=x.z.nativeEnum(u.a_),t4=x.z.nativeEnum(g.lk),t8=x.z.nativeEnum(s.YL),t7=x.z.nativeEnum(R),ne=x.z.array(t7),nt=x.z.custom(e=>/^0x[a-fA-F0-9]{40}$/.test(e)),nn=x.z.string().regex(/^[0-9]+$/),na=x.z.object({address:nt,decimals:x.z.number(),symbol:x.z.string()}).required(),nr=x.z.object({currency:na.required(),value:nn}).required(),ni=x.z.object({type:x.z.literal(0),reserve0:nr,reserve1:nr}).required(),nu=x.z.object({type:x.z.literal(1),token0:na,token1:na,fee:t4,liquidity:nn,sqrtRatioX96:nn,tick:x.z.number(),address:nt,token0ProtocolFee:x.z.string(),token1ProtocolFee:x.z.string()}).required(),ns=x.z.object({type:x.z.literal(2),balances:x.z.array(nr),amplifier:nn,fee:x.z.string()}).required(),no=x.z.array(x.z.union([ni,nu,ns])),np=x.z.object({chainId:t9,tradeType:t8,amount:nr,currency:na,gasPriceWei:nn.optional(),maxHops:x.z.number().optional(),maxSplits:x.z.number().optional(),blockNumber:nn.optional(),poolTypes:ne.optional()}).required({chainId:!0,tradeType:!0,amount:!0,currency:!0,candidatePools:!0}),nl=x.z.object({chainId:t9,tradeType:t8,amount:nr,currency:na,candidatePools:no,gasPriceWei:nn.optional(),maxHops:x.z.number().optional(),maxSplits:x.z.number().optional(),blockNumber:nn.optional(),poolTypes:ne.optional(),onChainQuoterGasLimit:nn.optional(),nativeCurrencyUsdPrice:x.z.number().optional(),quoteCurrencyUsdPrice:x.z.number().optional()}).required({chainId:!0,tradeType:!0,amount:!0,currency:!0,candidatePools:!0}),nd={};(0,i.r2)(nd,{APISchema:()=>nN,Transformer:()=>nH,getBestTrade:()=>nM,getV3CandidatePools:()=>nf,getV3Pools:()=>nT,log:()=>n1,logger:()=>n6,metric:()=>n2});var nc=[{inputs:[{internalType:"address",name:"pool",type:"address"},{internalType:"int16",name:"tickBitmapIndex",type:"int16"}],name:"getPopulatedTicksInWord",outputs:[{components:[{internalType:"int24",name:"tick",type:"int24"},{internalType:"int128",name:"liquidityNet",type:"int128"},{internalType:"uint128",name:"liquidityGross",type:"uint128"}],internalType:"struct ITickLens.PopulatedTick[]",name:"populatedTicks",type:"tuple[]"}],stateMutability:"view",type:"function"}],ny={gasLimit:3000000n,retryGasMultiplier:2},nm={};async function nf({currencyA:e,currencyB:t,clientProvider:n,gasLimit:a}){let r=e$(e,t);return nT({pairs:r,clientProvider:n,gasLimit:a})}async function nT({pairs:e,clientProvider:t,gasLimit:n}){let a=await tr(e||[],t);return a.length?nw({pools:a,clientProvider:t,gasLimit:n}):a}function ng(e,t){return Math.floor(e/t/256)}var nh=function({currentTick:e,fee:t,...n}){let a=g.LX[t],r=ng(e-1e3,a),i=ng(e+1e3,a);return Array.from(Array(i-r+1),(e,t)=>({bitmapIndex:r+t,...n}))};async function nw({pools:e,clientProvider:t,gasLimit:n}){let a=e[0]?.token0.chainId,r=i.x0[a],u=t?.({chainId:a});if(!u||!r)throw Error("Fill pools with ticks failed. No valid public client or tick lens found.");let{gasLimit:s,retryGasMultiplier:o}=nm[a]||ny,l=e.map(({tick:e,fee:t},n)=>nh({currentTick:e,fee:t,poolIndex:n})).reduce((e,t)=>[...e,...t],[]),c=await (0,N.I6)(l.map(({poolIndex:t,bitmapIndex:n})=>({target:r,callData:(0,p.R)({abi:nc,args:[e[t].address,n],functionName:"getPopulatedTicksInWord"}),gasLimit:s})),{chainId:a,client:u,gasLimit:n,retryFailedCallsWithGreaterLimit:{gasLimitMultiplier:o}}),y=e.map(e=>({...e}));for(let[e,t]of c.results.entries()){let{poolIndex:n}=l[e],a=y[n],r=t.success?(0,d.k)({abi:nc,functionName:"getPopulatedTicksInWord",data:t.result}):void 0,i=r?.map(({tick:e,liquidityNet:t,liquidityGross:n})=>new g.dR({index:e,liquidityNet:t,liquidityGross:n})).reverse();i&&(a.ticks=[...a.ticks||[],...i])}return y.filter(e=>e.ticks?.length)}function nb(e,t){return e.vertice0.currency.equals(t.currency)?e.vertice1:e.vertice0}function nA({graph:e,quote:t,gasPriceWei:n}){let{chainId:a}=t.currency,r=new Map,i=new Set,u=new Map,o=[],p=e=>{let t=u.get(e);if(void 0===t)throw Error(`Invalid weight for edge ${e}`);return t};for(r.set(t,new s.tA(t.currency,t.currency,1,1)),o=m(t),i.add(t);o.length;){let e=o.pop(),[t,n]=i.has(e.vertice1)?[e.vertice1,e.vertice0]:[e.vertice0,e.vertice1];if(i.has(n))continue;let a=j(e.pool,n.currency,t.currency),u=f(t);(0,A.Z)(void 0!==u,"Invalid quote price"),r.set(n,a.multiply(u)),o=m(n),i.add(n)}let l=s._r.onChain(a).wrapped,d=e.getVertice(l);if(!d)throw Error("No valid native currency price found");let c=f(d),y=c?.quote(s.ih.fromRawAmount(l,n));if(!y)throw Error("Failed to get gas price in quote");function m(e){let t=r.get(e);if(!t)throw Error("Invalid price");let n=e.edges.filter(n=>{if(i.has(nb(n,e)))return!1;let a=function(e,t){if(U(e))return e.token0.equals(t.wrapped)?e.reserve0:e.reserve1;if(_(e))return e.reserve0.currency.wrapped.equals(t.wrapped)?e.reserve0:e.reserve1;if(W(e))return e.balances.find(e=>e.currency.wrapped.equals(t.wrapped));throw Error("[Get reserve]: Unknown pool type")}(n.pool,e.currency);(0,A.Z)(void 0!==a,"Unexpected empty token reserve");let r=t.quote(a).quotient;return u.set(n,r),!0});n.sort((e,t)=>Number(p(e)-p(t)));let a=[];for(;o.length&&n.length;)p(o[0])<p(n[0])?a.push(o.shift()):a.push(n.shift());return[...a,...o,...n]}function f(e){return r.get(e)}return{graph:e,getGasPriceInBase:function(e){let t=f(e);return y?t?.invert().quote(y):void 0},getQuotePrice:f,getPrice:function(e,t){let n=f(e),a=f(t);return n&&a?n.multiply(a.invert()):void 0}}}function nv({pool:e,poolAfter:t}){if(_(e))return i.HZ;if(U(e)&&U(t)){let{ticks:n,token0:a,tick:r}=e;(0,A.Z)(void 0!==n,"[Estimate gas]: No valid tick list found");let{tick:u}=t,{chainId:s}=a,o=g.l$.countInitializedTicksCrossed(n,r,u),p=(0,i.Z$)(s)*BigInt(o);return(0,i.Pl)(s)+(0,i.oc)(s)+p}if(W(e))return i.qI;throw Error("[Estimate gas]: Unknown pool type")}function nI(e,t){if(!e&&!t)return;if(!e&&t)return t;if(e&&!t)return e;let n=e.tradeType===s.YL.EXACT_INPUT;return n?t.outputAmountWithGasAdjusted.greaterThan(e.outputAmountWithGasAdjusted)?t:e:t.inputAmountWithGasAdjusted.lessThan(e.inputAmountWithGasAdjusted)?t:e}function nE(e,t,n){let[a,r]=t.currency.wrapped.sortsBefore(n.currency.wrapped)?[t,n]:[n,t];return`${a.currency.chainId}-${a.currency.wrapped.address}-${r.currency.wrapped.address}-${z(e)}`}function nk({pools:e,graph:t}){if(t)return function(e){let t=e.edges.map(e=>e.pool);return nk({pools:t})}(t);if(!e)throw Error("[Create graph]: Invalid pools");let n=new Map,a=new Map;for(let t of e){let e=function(e){if(U(e))return[[e.token0,e.token1]];if(_(e))return[[e.reserve0.currency,e.reserve1.currency]];if(W(e)){let t=e.balances.map(e=>e.currency),n=[];for(let e=0;e<t.length;e++)for(let a=e+1;a<t.length;a++)n.push([t[e],t[a]]);return n}throw Error("[Get currency pairs]: Unknown pool type")}(t);for(let[n,r]of e){let e=u(n),i=u(r),s=function(e,t,n){let r=nE(e,t,n);if(!r)throw Error(`Create edge failed. Cannot get valid edge key for ${e}`);let i=a.get(r);if(i)return i;let u={vertice0:t,vertice1:n,pool:e};return a.set(r,u),u}(t,e,i);e.edges.includes(s)||e.edges.push(s),i.edges.includes(s)||i.edges.push(s)}}function r(e){return n.get(e.wrapped.address)}function i(e,t,n){return a.get(nE(e,t,n))}function u(e){let t=r(e);if(t)return t;let a={currency:e,edges:[]};return n.set(e.wrapped.address,a),a}let s=f((e,t,n,a)=>{if(e===t)return!0;if(n<=0)return!1;let r=a||new Set;for(let a of(r.add(e),e.edges)){let i=nb(a,e);if(i&&!r.has(i)&&s(i,t,n-1,r))return!0}return!1},(e,t,n)=>`${e.currency.chainId}-${e.currency.wrapped.address}-${t.currency.wrapped.address}-${n}`);return{vertices:Array.from(n.values()),edges:Array.from(a.values()),getVertice:r,getEdge:i,hasValidRouteToVerticeWithinHops:s,applySwap:async({isExactIn:e,route:t})=>{let n=tz(e),a=e?t.inputAmount:t.outputAmount;(0,A.Z)(void 0!==a,"[Apply swap]: Invalid base amount");let u=a,s=0n;for(let a of function*(){let n=e?0:t.pools.length-1,a=()=>e?n+1:n-1,r=e?()=>n<t.pools.length:()=>n>=0;for(;r();n=a())yield n}()){let e=r(t.path[a]),o=r(t.path[a+1]),p=t.pools[a];(0,A.Z)(void 0!==e&&void 0!==o&&void 0!==p,"[Apply swap]: Invalid vertice and pool");let l=i(p,e,o);(0,A.Z)(void 0!==l,"[Apply swap]: No valid edge found");let d=await n(l.pool,u);(0,A.Z)(void 0!==d,"[Apply swap]: Failed to get quote"),l.pool=d.poolAfter,u=d.quote,s+=nv(d)}return{amount:a,quote:u,gasCost:s}}}}var nP=({priceCalculator:e,gasCost:t,currency:n})=>{let a=e.graph.getVertice(n),r=a&&e.getGasPriceInBase(a),i=r?.multiply(t);return s.ih.fromRawAmount(n,i?.quotient||0)};async function nS(e){let t;let{tradeType:n,candidatePools:a,...r}=e,i=n===s.YL.EXACT_INPUT;if(i)return nq(e);let u=(function(e){let t=new Map;for(let n of e)t.set(n.type,[...t.get(n.type)||[],n]);return Array.from(t.values())})(a).filter(e=>!W(e[0])),o=await Promise.allSettled(u.map(e=>nq({tradeType:n,candidatePools:e,...r})));for(let e of o){if("rejected"===e.status)continue;let{value:n}=e;if(n){if(!t){t=n;continue}t=nI(t,n)}}return t}async function nq({amount:e,candidatePools:t,quoteCurrency:n,gasPriceWei:a,streams:r,graph:i,tradeType:u,maxHops:o=3}){let p=u===s.YL.EXACT_INPUT,l=e.currency,d=p?l:n,c=p?n:l,y=i||nk({pools:t}),m=function(e,t){let n=Array.isArray(t)?t.reduce((e,t)=>e+t,0):t,a=Array.isArray(t)?t.map(e=>new s.iA(e,n)):Array.from({length:t}).map(()=>new s.iA(1,n)),r=a.length,i=new s.iA(0),u=[];for(let[t,n]of a.entries()){let a=t===r-1?e.subtract(e.multiply(i)):e.multiply(n),o=t===r-1?new s.iA(1).subtract(i):n,p=100*Number(e2(o)||0);u.push({amount:a,percent:p}),i=i.add(n)}return u}(e,r),f=tz(p),T=BigInt("function"==typeof a?await a():a),g=y.getVertice(l),h=y.getVertice(n);if(!g||!h)throw Error(`Invalid start vertice or finish vertice. Start ${g}, finish ${h}`);let w=nA({quote:g,gasPriceWei:T,graph:y}),b=(e,t)=>p?e.subtract(t):e.add(t),v=(e,t)=>p?e.greaterThan(t):e.lessThan(t),I=(e,t)=>p?e:t,E=(e,t)=>p?t:e,k=e=>p?e.outputAmount:e.inputAmount,P=(t,a)=>{let{gasUseEstimate:r,quoteAmount:i,gasUseEstimateQuote:o,gasUseEstimateBase:p,inputAmountWithGasAdjusted:y,outputAmountWithGasAdjusted:m}=a.reduce((e,t)=>({gasUseEstimate:e.gasUseEstimate+t.gasUseEstimate,quoteAmount:e.quoteAmount.add(k(t)),gasUseEstimateBase:e.gasUseEstimateBase.add(t.gasUseEstimateBase),gasUseEstimateQuote:e.gasUseEstimateQuote.add(t.gasUseEstimateQuote),inputAmountWithGasAdjusted:e.inputAmountWithGasAdjusted.add(t.inputAmountWithGasAdjusted),outputAmountWithGasAdjusted:e.outputAmountWithGasAdjusted.add(t.outputAmountWithGasAdjusted)}),{gasUseEstimate:0n,quoteAmount:s.ih.fromRawAmount(n,0),gasUseEstimateBase:s.ih.fromRawAmount(l,0),gasUseEstimateQuote:s.ih.fromRawAmount(n,0),inputAmountWithGasAdjusted:s.ih.fromRawAmount(d,0),outputAmountWithGasAdjusted:s.ih.fromRawAmount(c,0)});return{gasUseEstimate:r,gasUseEstimateQuote:o,gasUseEstimateBase:p,inputAmountWithGasAdjusted:y,outputAmountWithGasAdjusted:m,inputAmount:I(e,i),outputAmount:E(e,i),tradeType:u,graph:t,routes:a}};async function S(e){(0,A.Z)(void 0!==g&&void 0!==h,"Invalid start/finish vertice");let t=new Map,a=new Set;t.set(g,{hops:0,bestAmount:e,gasSpent:0n});let r=[g],i=e=>t.get(e)?.hops||0,u=e=>t.get(e)?.bestAmount,d=e=>t.get(e)?.bestQuote,c=e=>t.get(e)?.bestSource,m=e=>t.get(e)?.gasSpent||0n,T=()=>{let e,t,n;for(let[a,i]of r.entries()){let r=d(i);(void 0===e||void 0===t||r&&v(r,t))&&(e=i,t=r,n=a)}return{vert:e,index:n}},k=t=>{let a=[],r=[t.currency];for(let e=h;c(e);e=nb(c(e),e)){let t=c(e);(0,A.Z)(void 0!==t,"Invalid best source");let n=nb(t,e);p?(a.unshift(t.pool),r.unshift(n?.currency)):(a.push(t.pool),r.push(n?.currency))}let i=m(t),o=u(t);(0,A.Z)(void 0!==o,"Invalid quote amount");let d=s.ih.fromRawAmount(n,o.quotient),y=nP({priceCalculator:w,gasCost:i,currency:l}),f=nP({priceCalculator:w,gasCost:i,currency:n}),T=s.ih.fromRawAmount(n,f?b(d,f).quotient:0),{type:v}=X(a,g.currency,h.currency);return{type:v,path:r,pools:a,gasUseEstimate:i,inputAmount:I(e,d),outputAmount:E(e,d),inputAmountWithGasAdjusted:I(e,T),outputAmountWithGasAdjusted:E(e,T),gasUseEstimateQuote:f,gasUseEstimateBase:y}};for(;;){let{vert:e,index:n}=T();if(!e||void 0===n)return;if(e===h)return k(e);r.splice(n,1);let s=i(e);for(let n of e.edges){let i=e===n.vertice0?n.vertice1:n.vertice0;if(!a.has(i)){if(!y.hasValidRouteToVerticeWithinHops(i,h,o-s-1))continue;try{let a=u(e);(0,A.Z)(void 0!==a,"Invalid amount");let o=await f(n.pool,a);(0,A.Z)(void 0!==o,"Invalid quote result");let{quote:p}=o,l=w.getGasPriceInBase(i);(0,A.Z)(void 0!==l,"Invalid gas price in v2");let y=nv(o)+m(e),T=w.getPrice(i,h);(0,A.Z)(void 0!==T,`Failed to get price, base ${i.currency.symbol}, quote ${h.currency.symbol}`);let g=T.quote(l.multiply(y)),I=b(T.quote(p),g),E=c(i),k=d(i);E||r.push(i),(!E||!k||v(I,k))&&t.set(i,{hops:s+1,gasSpent:y,bestAmount:p,bestSource:n,bestQuote:I})}catch(e){continue}}}a.add(e)}}let q=!1,M=[];for(let{amount:e,percent:t}of m){let a=await S(e);(0,A.Z)(void 0!==a,`No valid route found for base amount ${e.toExact()} ${e.currency.symbol} and quote currency ${n.symbol}`),await y.applySwap({route:a,isExactIn:p});let r={...a,percent:t},i=M.findIndex(e=>(function(e,t){if(e.pools.length!==t.pools.length)return!1;for(let[n,a]of e.pools.entries())if(a.type!==t.pools[n].type||z(a)!==z(t.pools[n]))return!1;return!0})(e,r));if(i<0)M.push(r);else{var N;M[i]={...N=M[i],inputAmount:N.inputAmount.add(r.inputAmount),outputAmount:N.outputAmount.add(r.outputAmount),gasUseEstimateQuote:r.gasUseEstimateQuote?N.gasUseEstimateQuote?.add(r.gasUseEstimateQuote):N.gasUseEstimateQuote,gasUseEstimate:N.gasUseEstimate+r.gasUseEstimate,inputAmountWithGasAdjusted:r.inputAmountWithGasAdjusted?N.inputAmountWithGasAdjusted?.add(r.inputAmountWithGasAdjusted):N.inputAmountWithGasAdjusted,outputAmountWithGasAdjusted:r.outputAmountWithGasAdjusted?N.outputAmountWithGasAdjusted?.add(r.outputAmountWithGasAdjusted):N.outputAmountWithGasAdjusted,percent:N.percent+r.percent},q=!0}}if(!M.length)return;if(!q)return P(y,M);let B=nk({graph:i,pools:t}),x=B.getVertice(l);(0,A.Z)(void 0!==x,"[Graph rebuild]: Invalid start vertice");let C=nA({quote:x,gasPriceWei:T,graph:B}),R=[];for(let e of M){let{amount:t,quote:a,gasCost:r}=await B.applySwap({isExactIn:p,route:e}),i=s.ih.fromRawAmount(n,a.quotient),u=nP({priceCalculator:C,gasCost:r,currency:l}),o=nP({priceCalculator:C,gasCost:r,currency:n}),d=s.ih.fromRawAmount(n,o?b(i,o).quotient:0);R.push({...e,gasUseEstimate:r,inputAmount:I(t,i),outputAmount:E(t,i),inputAmountWithGasAdjusted:I(t,d),outputAmountWithGasAdjusted:E(t,d),gasUseEstimateQuote:o,gasUseEstimateBase:u})}return P(B,R)}async function nM(e,t,n,{candidatePools:a,gasPriceWei:r,maxHops:i,maxSplits:u}){let o;let p=void 0!==u&&0===u;try{o=await nS({tradeType:n,amount:e,quoteCurrency:t,gasPriceWei:r,candidatePools:a,maxHops:i,streams:1})}catch(u){if(p)throw u;o=await nS({tradeType:n,amount:e,quoteCurrency:t,gasPriceWei:r,candidatePools:a,maxHops:i,streams:10})}if(p)return o;let l=function(e){if(!e)return 10;let t=K(e);if(!t)return 10;let{gasUseEstimateBase:n,inputAmount:a,outputAmount:r}=e;if(!n)return 10;let i=e.tradeType===s.YL.EXACT_INPUT?a:r,u=Math.sqrt(Number(n.toExact())*Number(i.toExact())/Number(e2(t.asFraction))),o=Math.round(Number(i.toExact())/u);return Number.isFinite(o)?Math.max(1,Math.min(o,100)):10}(o);if(1===l)return o;let d=await nS({tradeType:n,amount:e,quoteCurrency:t,gasPriceWei:r,candidatePools:a,maxHops:i,streams:l});return nI(o,d)}var nN={};(0,i.r2)(nN,{zPools:()=>nV,zRouterPostParams:()=>nD});var nB=x.z.nativeEnum(u.a_),nx=x.z.nativeEnum(g.lk),nC=x.z.nativeEnum(s.YL),nR=x.z.custom(e=>/^0x[a-fA-F0-9]{40}$/.test(e)),nO=x.z.string().regex(/^[0-9]+$/),n_=x.z.string().regex(/^-?[0-9]+$/),nU=x.z.object({address:nR,decimals:x.z.number(),symbol:x.z.string()}).required(),nW=x.z.object({index:x.z.number(),liquidityGross:n_,liquidityNet:n_}).required(),nL=x.z.object({currency:nU.required(),value:nO}),n$=nL.optional(),nG=nL.required(),nF=x.z.object({type:x.z.literal(0),reserve0:nG,reserve1:nG}).required(),nz=x.z.object({type:x.z.literal(1),token0:nU,token1:nU,fee:nx,liquidity:nO,sqrtRatioX96:nO,tick:x.z.number(),address:nR,token0ProtocolFee:x.z.string(),token1ProtocolFee:x.z.string(),reserve0:n$,reserve1:n$,ticks:x.z.array(nW).optional()}).required({type:!0,token0:!0,token1:!0,fee:!0,liquidity:!0,sqrtRatioX96:!0,tick:!0,address:!0,token0ProtocolFee:!0,token1ProtocolFee:!0}),nj=x.z.object({type:x.z.literal(2),balances:x.z.array(nG),amplifier:nO,fee:x.z.string()}).required(),nV=x.z.array(x.z.union([nz,nF,nj])),nD=x.z.object({chainId:nB,tradeType:nC,amount:nG,currency:nU,candidatePools:nV,gasPriceWei:nO.optional(),maxHops:x.z.number().optional(),maxSplits:x.z.number().optional()}).required({chainId:!0,tradeType:!0,amount:!0,currency:!0,candidatePools:!0}),nH={};function nQ(e){return{...e,pools:e.pools.map(eE),path:e.path.map(eA),inputAmount:ev(e.inputAmount),outputAmount:ev(e.outputAmount),gasUseEstimate:String(e.gasUseEstimate),gasUseEstimateBase:ev(e.gasUseEstimateBase),gasUseEstimateQuote:ev(e.gasUseEstimateQuote),inputAmountWithGasAdjusted:ev(e.inputAmountWithGasAdjusted),outputAmountWithGasAdjusted:ev(e.outputAmountWithGasAdjusted)}}function nX(e,t){return{...t,pools:t.pools.map(t=>eN(e,t)),path:t.path.map(t=>eq(e,t)),inputAmount:eM(e,t.inputAmount),outputAmount:eM(e,t.outputAmount),gasUseEstimate:BigInt(t.gasUseEstimate),gasUseEstimateBase:eM(e,t.gasUseEstimateBase),gasUseEstimateQuote:eM(e,t.gasUseEstimateQuote),inputAmountWithGasAdjusted:eM(e,t.inputAmountWithGasAdjusted),outputAmountWithGasAdjusted:eM(e,t.outputAmountWithGasAdjusted)}}function nZ(e){let{graph:t,...n}=e;return{...n,inputAmount:ev(e.inputAmount),outputAmount:ev(e.outputAmount),routes:e.routes.map(nQ),gasUseEstimate:e.gasUseEstimate.toString(),gasUseEstimateBase:ev(e.gasUseEstimateBase),gasUseEstimateQuote:ev(e.gasUseEstimateQuote),inputAmountWithGasAdjusted:ev(e.inputAmountWithGasAdjusted),outputAmountWithGasAdjusted:ev(e.outputAmountWithGasAdjusted)}}function nY(e,t){return{...t,inputAmount:eM(e,t.inputAmount),outputAmount:eM(e,t.outputAmount),routes:t.routes.map(t=>nX(e,t)),gasUseEstimate:t.gasUseEstimate?BigInt(t.gasUseEstimate):0n,gasUseEstimateBase:eM(e,t.gasUseEstimateBase),gasUseEstimateQuote:eM(e,t.gasUseEstimateQuote),inputAmountWithGasAdjusted:eM(e,t.inputAmountWithGasAdjusted),outputAmountWithGasAdjusted:eM(e,t.outputAmountWithGasAdjusted)}}(0,i.r2)(nH,{parseRoute:()=>nX,parseTrade:()=>nY,serializeRoute:()=>nQ,serializeTrade:()=>nZ});var nK="v4-router",nJ={metric:"metric",log:"log",error:"error"},n0=b(nK),n2=n0.extend(nJ.metric),n1=n0.extend(nJ.log),n6={metric:n2,log:n1,error:b(nK).extend(nJ.error),enable:e=>{let t=e;t=e.includes(",")?e.split(",").map(e=>`${nK}:${e}`).join(","):`${nK}:${e}`,b.enable(t)}}}}]);
//# sourceMappingURL=fbb9a3fc-f947efd9a1a13837.js.map